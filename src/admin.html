---
layout: null
title: Admin Panel
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Nuwah</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f5f5;
    }

    header {
        display: none;
    }

    .admin-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 80px 20px 20px 20px;
    }

    .admin-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .admin-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .admin-header-actions {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-top: 20px;
    }

    .download-dropdown {
        position: relative;
        display: inline-block;
    }

    .download-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .download-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
    }

    .download-dropdown-content {
        display: none;
        position: absolute;
        background: white;
        min-width: 200px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        z-index: 1000;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 5px;
    }

    .download-dropdown-content.show {
        display: block;
    }

    .download-dropdown-item {
        color: #333;
        padding: 12px 20px;
        text-decoration: none;
        display: block;
        cursor: pointer;
        transition: background 0.2s;
    }

    .download-dropdown-item:hover {
        background: #f0f0f0;
    }

    .download-dropdown-item i {
        margin-right: 8px;
        width: 20px;
    }

    .admin-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .admin-tab {
        padding: 12px 24px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .admin-tab:hover {
        background: #f0f0f0;
    }

    .admin-tab.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .admin-content {
        display: none;
        max-height: calc(100vh - 200px);
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 10px;
    }

    .admin-content.active {
        display: block;
    }

    /* Custom scrollbar for admin content */
    .admin-content::-webkit-scrollbar {
        width: 8px;
    }

    .admin-content::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .admin-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    .admin-content::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    .admin-section {
        background: white;
        padding: 40px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        max-height: none;
        overflow: visible;
    }

    .admin-section h2 {
        color: #333;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
    }

    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }

    .form-group textarea {
        min-height: 100px;
        resize: vertical;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
    }

    .btn-primary {
        background: #667eea;
        color: white;
    }

    .btn-primary:hover {
        background: #5568d3;
    }

    .btn-success {
        background: #10b981;
        color: white;
    }

    .btn-success:hover {
        background: #059669;
    }

    .btn-danger {
        background: #ef4444;
        color: white;
    }

    .btn-danger:hover {
        background: #dc2626;
    }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }

    .btn-secondary:hover {
        background: #4b5563;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 12px;
    }

    .item-card {
        background: #f9fafb;
        padding: 30px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 2px solid #e0e0e0;
        max-height: 80vh;
        overflow-y: auto;
        overflow-x: hidden;
    }

    /* Custom scrollbar for item cards */
    .item-card::-webkit-scrollbar {
        width: 6px;
    }

    .item-card::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }

    .item-card::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
    }

    .item-card::-webkit-scrollbar-thumb:hover {
        background: #999;
    }

    .item-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e0e0e0;
    }

    .item-card h3 {
        color: #333;
        margin: 0;
    }

    .nested-section {
        background: #ffffff;
        padding: 25px;
        border-radius: 6px;
        margin-top: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
        max-height: 60vh;
        overflow-y: auto;
        overflow-x: hidden;
    }

    /* Custom scrollbar for nested sections */
    .nested-section::-webkit-scrollbar {
        width: 6px;
    }

    .nested-section::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }

    .nested-section::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
    }

    .nested-section::-webkit-scrollbar-thumb:hover {
        background: #999;
    }

    .nested-section h4 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 1.1rem;
    }

    .array-items-container {
        max-height: 50vh;
        overflow-y: auto;
        overflow-x: hidden;
        margin-bottom: 15px;
    }

    /* Custom scrollbar for array containers */
    .array-items-container::-webkit-scrollbar {
        width: 6px;
    }

    .array-items-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }

    .array-items-container::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
    }

    .array-items-container::-webkit-scrollbar-thumb:hover {
        background: #999;
    }

    .array-item {
        background: #f9fafb;
        padding: 20px;
        border-radius: 6px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
        position: relative;
    }

    .array-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
    }

    .array-item-title {
        font-weight: 600;
        color: #333;
    }

    .actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .alert {
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    .alert-success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #10b981;
    }

    .alert-error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #ef4444;
    }

    .collapsible {
        cursor: pointer;
        user-select: none;
    }

    .collapsible::before {
        content: 'â–¼ ';
        display: inline-block;
        transition: transform 0.3s;
    }

    .collapsible.collapsed::before {
        transform: rotate(-90deg);
    }

    .collapsible-content.collapsed {
        max-height: 0;
        overflow: hidden;
    }

    .image-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }

    .image-item {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 6px;
        overflow: hidden;
        border: 2px solid #e0e0e0;
    }

    .image-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .image-item .remove-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(239, 68, 68, 0.9);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        font-size: 12px;
    }

    .add-image-btn {
        width: 100px;
        height: 100px;
        border: 2px dashed #667eea;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #667eea;
        font-size: 24px;
        transition: all 0.3s;
    }

    .add-image-btn:hover {
        background: #f0f4ff;
    }

    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="admin-container">
    <div class="admin-header">
        <h1>ðŸš€ Nuwah Admin Panel</h1>
        <p>Manage your website content: Packages, Products, Furniture, and Projects</p>
        <p style="font-size: 0.9rem; opacity: 0.9; margin-top: 10px;">
            <i class="fas fa-info-circle"></i> 
            <strong>Cloudflare Pages:</strong> "Save to JSON" will automatically update files in your GitHub repository. 
            <a href="#" onclick="clearGitHubToken(); return false;" style="color: rgba(255,255,255,0.8); text-decoration: underline; margin-left: 10px;">Clear GitHub Token</a>
        </p>
        <div class="admin-header-actions">
            <div class="download-dropdown">
                <button class="download-btn" onclick="toggleDownloadDropdown()">
                    <i class="fas fa-download"></i> Download JSON Files
                    <i class="fas fa-chevron-down" style="font-size: 12px;"></i>
                </button>
                <div class="download-dropdown-content" id="downloadDropdown">
                    <a href="#" class="download-dropdown-item" onclick="downloadJSON('packages'); return false;">
                        <i class="fas fa-file-code"></i> packages.json
                    </a>
                    <a href="#" class="download-dropdown-item" onclick="downloadJSON('products'); return false;">
                        <i class="fas fa-file-code"></i> products.json
                    </a>
                    <a href="#" class="download-dropdown-item" onclick="downloadJSON('furniture'); return false;">
                        <i class="fas fa-file-code"></i> furniture.json
                    </a>
                    <a href="#" class="download-dropdown-item" onclick="downloadJSON('projects'); return false;">
                        <i class="fas fa-file-code"></i> projects.json
                    </a>
                    <a href="#" class="download-dropdown-item" onclick="downloadJSON('homepage'); return false;">
                        <i class="fas fa-file-code"></i> homepage.json
                    </a>
                    <a href="#" class="download-dropdown-item" onclick="downloadJSON('design-services'); return false;">
                        <i class="fas fa-file-code"></i> designServices.json
                    </a>
                    <a href="#" class="download-dropdown-item" onclick="downloadJSON('contact'); return false;">
                        <i class="fas fa-file-code"></i> contact.json
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="alertContainer"></div>

    <div class="admin-tabs">
        <div class="admin-tab active" data-tab="homepage">Homepage</div>
        <div class="admin-tab" data-tab="packages">Packages</div>
        <div class="admin-tab" data-tab="products">Products</div>
        <div class="admin-tab" data-tab="furniture">Furniture</div>
        <div class="admin-tab" data-tab="design-services">Design Services</div>
        <div class="admin-tab" data-tab="projects">Projects</div>
        <div class="admin-tab" data-tab="contact">Contact</div>
    </div>

    <!-- Homepage Tab -->
    <div class="admin-content active" id="homepage-tab">
        <div class="admin-section">
            <h2>Homepage Customization</h2>
            <div id="homepage-content"></div>
        </div>
        <div class="actions">
            <button class="btn btn-primary" onclick="loadHomepageData()">Load Current Data</button>
            <button class="btn btn-success" onclick="saveHomepageData()">Save to JSON</button>
        </div>
    </div>

    <!-- Packages Tab -->
    <div class="admin-content" id="packages-tab">
        <div class="admin-section">
            <h2>Packages Management</h2>
            <div id="packages-list"></div>
            <button class="btn btn-secondary" onclick="addPackage()">+ Add New Package</button>
        </div>
        <div class="actions">
            <button class="btn btn-primary" onclick="loadPackagesData()">Load Current Data</button>
            <button class="btn btn-success" onclick="savePackagesData()">Save to JSON</button>
        </div>
    </div>

    <!-- Products Tab -->
    <div class="admin-content" id="products-tab">
        <div class="admin-section">
            <h2>Products Management</h2>
            <div id="products-list"></div>
            <button class="btn btn-secondary" onclick="addProduct()">+ Add New Product</button>
        </div>
        <div class="actions">
            <button class="btn btn-primary" onclick="loadProductsData()">Load Current Data</button>
            <button class="btn btn-success" onclick="saveProductsData()">Save to JSON</button>
        </div>
    </div>

    <!-- Furniture Tab -->
    <div class="admin-content" id="furniture-tab">
        <div class="admin-section">
            <h2>Furniture Management</h2>
            <div id="furniture-list"></div>
            <button class="btn btn-secondary" onclick="addFurnitureCategory()">+ Add New Category</button>
        </div>
        <div class="actions">
            <button class="btn btn-primary" onclick="loadFurnitureData()">Load Current Data</button>
            <button class="btn btn-success" onclick="saveFurnitureData()">Save to JSON</button>
        </div>
    </div>

    <!-- Design Services Tab -->
    <div class="admin-content" id="design-services-tab">
        <div class="admin-section">
            <h2>Design Services Page Customization</h2>
            <div id="design-services-content"></div>
        </div>
        <div class="actions">
            <button class="btn btn-primary" onclick="loadDesignServicesData()">Load Current Data</button>
            <button class="btn btn-success" onclick="saveDesignServicesData()">Save to JSON</button>
        </div>
    </div>

    <!-- Projects Tab -->
    <div class="admin-content" id="projects-tab">
        <div class="admin-section">
            <h2>Projects Management</h2>
            <div id="projects-list"></div>
            <button class="btn btn-secondary" onclick="addProject()">+ Add New Project</button>
        </div>
        <div class="actions">
            <button class="btn btn-primary" onclick="loadProjectsData()">Load Current Data</button>
            <button class="btn btn-success" onclick="saveProjectsData()">Save to JSON</button>
        </div>
    </div>

    <!-- Contact Tab -->
    <div class="admin-content" id="contact-tab">
        <div class="admin-section">
            <h2>Contact Page Customization</h2>
            <div id="contact-content"></div>
        </div>
        <div class="actions">
            <button class="btn btn-primary" onclick="loadContactData()">Load Current Data</button>
            <button class="btn btn-success" onclick="saveContactData()">Save to JSON</button>
        </div>
    </div>
</div>

<script>
    let homepageData = {};
    let designServicesData = {};
    let packagesData = { packages: [] };
    let productsData = { products: [] };
    let furnitureData = [];
    let projectsData = { projects: [] };

    function getApiBaseUrl() {
        return '';
    }

    // GitHub API integration for Cloudflare Pages
    async function getGitHubToken() {
        let token = localStorage.getItem('github_token');
        if (!token) {
            token = prompt('Enter your GitHub Fine-grained Personal Access Token:\n\n' +
                'Create one at: https://github.com/settings/tokens?type=beta\n' +
                '1. Click "Generate new token" â†’ "Generate new token (fine-grained)"\n' +
                '2. Name: "Nuwah Admin Panel"\n' +
                '3. Repository access: Select "Only select repositories" â†’ Choose "Nuwah"\n' +
                '4. Permissions â†’ Repository permissions:\n' +
                '   - Contents: Read and write (REQUIRED - for file updates)\n' +
                '   - Actions: Read and write (NOT NEEDED - only for workflows)\n' +
                '5. Generate token and paste it here');
            if (token) {
                const save = confirm('Save token for future use? (stored in browser localStorage)');
                if (save) {
                    localStorage.setItem('github_token', token);
                }
            }
        }
        return token;
    }

    async function getFileSHA(filePath) {
        const token = await getGitHubToken();
        if (!token) return null;

        try {
            const response = await fetch(
                `https://api.github.com/repos/Has-sh/Nuwah/contents/${filePath}`,
                {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                }
            );
            if (response.ok) {
                const data = await response.json();
                return data.sha;
            }
        } catch (error) {
            console.error('Error getting file SHA:', error);
        }
        return null;
    }

    async function saveToGitHub(filePath, data) {
        const token = await getGitHubToken();
        if (!token) {
            showAlert('GitHub token required. Please enter your Personal Access Token.', 'error');
            return false;
        }

        try {
            const content = JSON.stringify(data, null, 2);
            const encodedContent = btoa(unescape(encodeURIComponent(content)));
            const sha = await getFileSHA(filePath);

            const body = {
                message: `Update ${filePath} via admin panel`,
                content: encodedContent,
                branch: 'main'
            };

            if (sha) {
                body.sha = sha; // Update existing file
            }

            const response = await fetch(
                `https://api.github.com/repos/Has-sh/Nuwah/contents/${filePath}`,
                {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                }
            );

            if (response.ok) {
                return true;
            } else {
                const error = await response.json();
                throw new Error(error.message || 'Failed to save to GitHub');
            }
        } catch (error) {
            console.error('GitHub API error:', error);
            // If token is invalid, clear it
            if (error.message && error.message.includes('Bad credentials')) {
                localStorage.removeItem('github_token');
                showAlert('Invalid GitHub token. Please try again.', 'error');
            }
            return false;
        }
    }

    function clearGitHubToken() {
        localStorage.removeItem('github_token');
        showAlert('GitHub token cleared. You will be prompted for a new token on next save.', 'success');
    }

    // Tab switching
    document.querySelectorAll('.admin-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
        });
    });

    // Utility: Create form field
    function createFormField(label, value, onChange, type = 'text', placeholder = '') {
        const group = document.createElement('div');
        group.className = 'form-group';
        group.innerHTML = `
            <label>${label}</label>
            ${type === 'textarea' 
                ? `<textarea placeholder="${placeholder}" onchange="${onChange}">${value || ''}</textarea>`
                : `<input type="${type}" value="${value || ''}" placeholder="${placeholder}" onchange="${onChange}">`
            }
        `;
        return group;
    }

    // Utility: Create array field (for images, features, etc.)
    function createArrayField(label, items, onAdd, onRemove, renderItem) {
        const group = document.createElement('div');
        group.className = 'form-group';
        group.innerHTML = `
            <label>${label}</label>
            <div class="array-items-container"></div>
            <button type="button" class="btn btn-secondary btn-sm" onclick="${onAdd}">+ Add Item</button>
        `;
        const container = group.querySelector('.array-items-container');
        items.forEach((item, index) => {
            const itemEl = renderItem(item, index, onRemove);
            container.appendChild(itemEl);
        });
        return group;
    }

    // Utility: Create image array field
    function createImageArrayField(label, images, addCallback, removeCallback) {
        const group = document.createElement('div');
        group.className = 'form-group';
        const labelEl = document.createElement('label');
        labelEl.textContent = label;
        group.appendChild(labelEl);
        
        const imageList = document.createElement('div');
        imageList.className = 'image-list';
        
        images.forEach((img, index) => {
            const imageItem = document.createElement('div');
            imageItem.className = 'image-item';
            const imgEl = document.createElement('img');
            imgEl.src = img;
            imgEl.alt = `Image ${index + 1}`;
            imgEl.onerror = () => { imgEl.src = 'https://via.placeholder.com/100'; };
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'remove-btn';
            removeBtn.innerHTML = 'Ã—';
            removeBtn.onclick = () => removeCallback(index);
            imageItem.appendChild(imgEl);
            imageItem.appendChild(removeBtn);
            imageList.appendChild(imageItem);
        });
        
        const addBtn = document.createElement('div');
        addBtn.className = 'add-image-btn';
        addBtn.innerHTML = '+';
        addBtn.onclick = () => {
            const url = prompt('Enter image URL:');
            if (url) addCallback(url);
        };
        imageList.appendChild(addBtn);
        
        group.appendChild(imageList);
        return group;
    }

    // Utility: Toggle collapsible
    function toggleCollapsible(element) {
        element.classList.toggle('collapsed');
        const content = element.nextElementSibling;
        if (content) {
            content.classList.toggle('collapsed');
        }
    }

    // Utility: Create image upload field
    function createImageUploadField(label, currentImage, onChange) {
        const group = document.createElement('div');
        group.className = 'form-group';
        group.innerHTML = `
            <label>${label}</label>
            <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                ${currentImage ? `<img src="${currentImage}" alt="Preview" style="max-width: 200px; max-height: 150px; border-radius: 6px; border: 2px solid #e0e0e0;">` : ''}
                <div style="flex: 1;">
                    <input type="text" value="${currentImage || ''}" placeholder="Enter image URL or path" 
                        onchange="${onChange}" style="margin-bottom: 10px;">
                    <button type="button" class="btn btn-secondary btn-sm" onclick="this.previousElementSibling.value=''; ${onChange.replace('this.value', '\'\'')}">
                        Clear Image
                    </button>
                </div>
            </div>
        `;
        return group;
    }

    // HOMEPAGE MANAGEMENT
    async function loadHomepageData() {
        try {
            const apiBase = getApiBaseUrl();
            let response;
            
            // Try API first (for local development)
            try {
                response = await fetch(`${apiBase}/api/homepage`);
                if (response.ok) {
                    homepageData = await response.json();
                    renderHomepageContent();
                    showAlert('Homepage data loaded successfully!', 'success');
                    return;
                }
            } catch (apiError) {
                // API not available, continue to static file fallback
            }
            
            // Fallback to static files
            const staticPaths = [
                `${apiBase}/_data/homepage.json`,
                `${apiBase}/src/_data/homepage.json`,
                '/_data/homepage.json',
                '/src/_data/homepage.json'
            ];
            
            for (const path of staticPaths) {
                try {
                    response = await fetch(path);
                    if (response.ok) {
                        homepageData = await response.json();
                        renderHomepageContent();
                        showAlert('Homepage data loaded successfully!', 'success');
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            throw new Error('Could not load homepage data from any source');
        } catch (error) {
            console.error('Error loading homepage data:', error);
            showAlert('Error loading homepage data. Make sure the JSON file exists in your repository.', 'error');
        }
    }

    function renderHomepageContent() {
        const container = document.getElementById('homepage-content');
        if (!container) return;
        
        container.innerHTML = '';
        
        // Hero Section
        const heroSection = createHomepageSection('Hero Section', 'hero', () => {
            const hero = homepageData.hero || {};
            return `
                ${createFormField('Welcome Text', hero.welcomeText || '', 'updateHomepageField("hero", "welcomeText", this.value)').outerHTML}
                ${createFormField('Tagline', hero.tagline || '', 'updateHomepageField("hero", "tagline", this.value)').outerHTML}
                ${createFormField('Description', hero.description || '', 'updateHomepageField("hero", "description", this.value)', 'textarea').outerHTML}
                ${createImageUploadField('Hero Image', hero.heroImage || '', 'updateHomepageField("hero", "heroImage", this.value)').outerHTML}
                <div class="nested-section">
                    <h4>Primary Button</h4>
                    ${createFormField('Button Text', hero.primaryButton?.text || '', 'updateHomepageNested("hero", "primaryButton", "text", this.value)').outerHTML}
                    ${createFormField('Button Link', hero.primaryButton?.link || '', 'updateHomepageNested("hero", "primaryButton", "link", this.value)').outerHTML}
                </div>
                <div class="nested-section">
                    <h4>Secondary Button</h4>
                    ${createFormField('Button Text', hero.secondaryButton?.text || '', 'updateHomepageNested("hero", "secondaryButton", "text", this.value)').outerHTML}
                    ${createFormField('Button Link', hero.secondaryButton?.link || '', 'updateHomepageNested("hero", "secondaryButton", "link", this.value)').outerHTML}
                </div>
                <div class="nested-section">
                    <h4>Social Links</h4>
                    ${createFormField('Instagram', hero.socialLinks?.instagram || '', 'updateHomepageNested("hero", "socialLinks", "instagram", this.value)').outerHTML}
                    ${createFormField('Twitter', hero.socialLinks?.twitter || '', 'updateHomepageNested("hero", "socialLinks", "twitter", this.value)').outerHTML}
                    ${createFormField('Facebook', hero.socialLinks?.facebook || '', 'updateHomepageNested("hero", "socialLinks", "facebook", this.value)').outerHTML}
                </div>
            `;
        });
        container.appendChild(heroSection);

        // Packages Section
        const packagesSection = createHomepageSection('Packages Section', 'packagesSection', () => {
            if (!homepageData.packagesSection) homepageData.packagesSection = {};
            if (!homepageData.packagesSection.packages) homepageData.packagesSection.packages = [];
            const section = homepageData.packagesSection;
            const packages = section.packages || [];
            return `
                ${createFormField('Subtitle', section.subtitle || '', 'updateHomepageField("packagesSection", "subtitle", this.value)').outerHTML}
                ${createFormField('Title', section.title || '', 'updateHomepageField("packagesSection", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Package Cards</label>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Customize each package card displayed on the homepage.</p>
                    ${renderPackageCards(packages)}
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addPackageCard()" style="margin-top: 15px;">+ Add New Package Card</button>
                </div>
            `;
        });
        container.appendChild(packagesSection);

        // Furniture Section
        const furnitureSection = createHomepageSection('Furniture Section', 'furnitureSection', () => {
            if (!homepageData.furnitureSection) homepageData.furnitureSection = {};
            if (!homepageData.furnitureSection.furniture) homepageData.furnitureSection.furniture = [];
            const section = homepageData.furnitureSection;
            const furniture = section.furniture || [];
            return `
                ${createFormField('Subtitle', section.subtitle || '', 'updateHomepageField("furnitureSection", "subtitle", this.value)').outerHTML}
                ${createFormField('Title', section.title || '', 'updateHomepageField("furnitureSection", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Furniture Cards</label>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Customize each furniture card displayed on the homepage.</p>
                    ${renderFurnitureCards(furniture)}
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addFurnitureCard()" style="margin-top: 15px;">+ Add New Furniture Card</button>
                </div>
            `;
        });
        container.appendChild(furnitureSection);

        // Info Section
        const infoSection = createHomepageSection('Info Section', 'infoSection', () => {
            const section = homepageData.infoSection || {};
            return `
                ${createFormField('Years', section.years || '', 'updateHomepageField("infoSection", "years", this.value)').outerHTML}
                ${createFormField('Title', section.title || '', 'updateHomepageField("infoSection", "title", this.value)').outerHTML}
                ${createFormField('Description', section.description || '', 'updateHomepageField("infoSection", "description", this.value)', 'textarea').outerHTML}
                ${createFormField('Learn More Link', section.learnMoreLink || '', 'updateHomepageField("infoSection", "learnMoreLink", this.value)').outerHTML}
                ${createFormField('Brand', section.brand || '', 'updateHomepageField("infoSection", "brand", this.value)').outerHTML}
                ${createFormField('Brand Description (HTML allowed)', section.brandDescription || '', 'updateHomepageField("infoSection", "brandDescription", this.value)', 'textarea').outerHTML}
                <div class="nested-section">
                    <h4>Stats</h4>
                    ${renderStats(section.stats || [])}
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addStat()">+ Add Stat</button>
                </div>
            `;
        });
        container.appendChild(infoSection);

        // Projects Section
        const projectsSection = createHomepageSection('Projects Section', 'projectsSection', () => {
            if (!homepageData.projectsSection) homepageData.projectsSection = {};
            if (!homepageData.projectsSection.projectTypes) homepageData.projectsSection.projectTypes = {};
            const section = homepageData.projectsSection;
            const projectTypes = section.projectTypes || {};
            
            let html = `
                ${createFormField('Subtitle', section.subtitle || '', 'updateHomepageField("projectsSection", "subtitle", this.value)').outerHTML}
                ${createFormField('Title', section.title || '', 'updateHomepageField("projectsSection", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Project Types (Before/After Images)</label>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Customize before and after images for each project type (Residential, Commercial, etc.).</p>
            `;
            
            // Render each project type
            const types = ['Residential', 'Commercial', 'Lighting Design', 'Art Deco'];
            types.forEach((type) => {
                const typeData = projectTypes[type] || { before: '', after: '' };
                html += `
                    <div class="nested-section" style="margin-top: 15px;">
                        <h4 style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0;">${type}</h4>
                        ${createImageUploadField('Before Image', typeData.before || '', `updateProjectType("${type}", "before", this.value)`).outerHTML}
                        ${createImageUploadField('After Image', typeData.after || '', `updateProjectType("${type}", "after", this.value)`).outerHTML}
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        });
        container.appendChild(projectsSection);

        // Reviews Section
        const reviewsSection = createHomepageSection('Reviews Section', 'reviewsSection', () => {
            const section = homepageData.reviewsSection || {};
            return `
                ${createFormField('Subtitle', section.subtitle || '', 'updateHomepageField("reviewsSection", "subtitle", this.value)').outerHTML}
                ${createFormField('Title', section.title || '', 'updateHomepageField("reviewsSection", "title", this.value)').outerHTML}
            `;
        });
        container.appendChild(reviewsSection);

        // Contact Section
        const contactSection = createHomepageSection('Contact Section', 'contactSection', () => {
            const section = homepageData.contactSection || {};
            return `
                ${createFormField('Title', section.title || '', 'updateHomepageField("contactSection", "title", this.value)').outerHTML}
                ${createFormField('Address (HTML allowed)', section.address || '', 'updateHomepageField("contactSection", "address", this.value)', 'textarea').outerHTML}
                ${createFormField('Phone', section.phone || '', 'updateHomepageField("contactSection", "phone", this.value)').outerHTML}
                ${createFormField('Email', section.email || '', 'updateHomepageField("contactSection", "email", this.value)').outerHTML}
                ${createFormField('Button Text', section.buttonText || '', 'updateHomepageField("contactSection", "buttonText", this.value)').outerHTML}
            `;
        });
        container.appendChild(contactSection);
    }

    function createHomepageSection(title, key, contentFn) {
        const section = document.createElement('div');
        section.className = 'item-card';
        section.innerHTML = `
            <div class="item-card-header">
                <h3>${title}</h3>
                <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="collapsible-content">
                ${contentFn()}
            </div>
        `;
        return section;
    }

    function updateHomepageField(section, field, value) {
        if (!homepageData[section]) homepageData[section] = {};
        homepageData[section][field] = value;
    }

    function updateHomepageNested(section, nested, field, value) {
        if (!homepageData[section]) homepageData[section] = {};
        if (!homepageData[section][nested]) homepageData[section][nested] = {};
        homepageData[section][nested][field] = value;
    }

    function updateCategorySection(key, field, value) {
        if (!homepageData.categorySections) homepageData.categorySections = {};
        if (!homepageData.categorySections[key]) homepageData.categorySections[key] = {};
        homepageData.categorySections[key][field] = value;
    }

    function renderCategoryCards(categoryKey, cards) {
        let html = '<div class="array-items-container">';
        cards.forEach((card, index) => {
            html += `
                <div class="array-item">
                    <div class="form-group">
                        <label>Card ${index + 1}</label>
                        ${createFormField('ID', card.id || '', `updateCategoryCard("${categoryKey}", ${index}, "id", this.value)`).outerHTML}
                        ${createFormField('Title', card.title || '', `updateCategoryCard("${categoryKey}", ${index}, "title", this.value)`).outerHTML}
                        ${createFormField('Subtitle', card.subtitle || '', `updateCategoryCard("${categoryKey}", ${index}, "subtitle", this.value)`).outerHTML}
                        ${createFormField('Link/URL', card.link || '', `updateCategoryCard("${categoryKey}", ${index}, "link", this.value)`, 'text', 'e.g., /furnitures/?category=sectional-sofas').outerHTML}
                        <div class="form-group">
                            <label>Images (used as background for the card)</label>
                            ${renderCategoryCardImages(categoryKey, index, card.images || [])}
                        </div>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeCategoryCard('${categoryKey}', ${index})">Remove Card</button>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        return html;
    }

    function addCategoryCard(categoryKey) {
        if (!homepageData.categorySections) homepageData.categorySections = {};
        if (!homepageData.categorySections[categoryKey]) homepageData.categorySections[categoryKey] = { cards: [] };
        if (!homepageData.categorySections[categoryKey].cards) homepageData.categorySections[categoryKey].cards = [];
        homepageData.categorySections[categoryKey].cards.push({
            id: '',
            title: '',
            subtitle: '',
            link: '',
            images: []
        });
        renderHomepageContent();
    }

    function removeCategoryCard(categoryKey, index) {
        if (homepageData.categorySections?.[categoryKey]?.cards) {
            homepageData.categorySections[categoryKey].cards.splice(index, 1);
            renderHomepageContent();
        }
    }

    function updateCategoryCard(categoryKey, index, field, value) {
        if (homepageData.categorySections?.[categoryKey]?.cards?.[index]) {
            homepageData.categorySections[categoryKey].cards[index][field] = value;
        }
    }

    function addCategoryCardImage(categoryKey, cardIndex) {
        const url = prompt('Enter image URL:');
        if (url && homepageData.categorySections?.[categoryKey]?.cards?.[cardIndex]) {
            if (!homepageData.categorySections[categoryKey].cards[cardIndex].images) {
                homepageData.categorySections[categoryKey].cards[cardIndex].images = [];
            }
            homepageData.categorySections[categoryKey].cards[cardIndex].images.push(url);
            renderHomepageContent();
        }
    }

    function renderCategoryCardImages(categoryKey, cardIndex, images) {
        let html = '<div class="image-list">';
        images.forEach((img, imgIndex) => {
            html += `
                <div class="image-item">
                    <img src="${img}" alt="Image ${imgIndex + 1}" onerror="this.src='https://via.placeholder.com/100'">
                    <button type="button" class="remove-btn" onclick="removeCategoryCardImage('${categoryKey}', ${cardIndex}, ${imgIndex})">Ã—</button>
                </div>
            `;
        });
        html += `
            <div class="add-image-btn" onclick="addCategoryCardImage('${categoryKey}', ${cardIndex})">+</div>
        </div>`;
        return html;
    }

    function removeCategoryCardImage(categoryKey, cardIndex, imageIndex) {
        if (homepageData.categorySections?.[categoryKey]?.cards?.[cardIndex]?.images) {
            homepageData.categorySections[categoryKey].cards[cardIndex].images.splice(imageIndex, 1);
            renderHomepageContent();
        }
    }

    function addCategoryArray() {
        if (!homepageData.categories) homepageData.categories = [];
        homepageData.categories.push({ id: '', label: '', icon: '', link: '' });
        renderHomepageContent();
    }

    function removeCategoryArray(index) {
        if (homepageData.categories) {
            homepageData.categories.splice(index, 1);
            renderHomepageContent();
        }
    }

    function updateCategoryArray(index, field, value) {
        if (homepageData.categories?.[index]) {
            homepageData.categories[index][field] = value;
        }
    }

    function renderShowcaseImages(images) {
        let html = '<div class="image-list">';
        images.forEach((img, imgIndex) => {
            html += `
                <div class="image-item">
                    <img src="${img}" alt="Image ${imgIndex + 1}" onerror="this.src='https://via.placeholder.com/100'">
                    <button type="button" class="remove-btn" onclick="removeShowcaseImage(${imgIndex})">Ã—</button>
                </div>
            `;
        });
        html += `
            <div class="add-image-btn" onclick="addShowcaseImage()">+</div>
        </div>`;
        return html;
    }

    function addShowcaseImage() {
        const url = prompt('Enter image URL:');
        if (url) {
            if (!homepageData.showcaseSection) homepageData.showcaseSection = {};
            if (!homepageData.showcaseSection.images) homepageData.showcaseSection.images = [];
            homepageData.showcaseSection.images.push(url);
            renderHomepageContent();
        }
    }

    function removeShowcaseImage(index) {
        if (homepageData.showcaseSection?.images) {
            homepageData.showcaseSection.images.splice(index, 1);
            renderHomepageContent();
        }
    }

    function renderPackageCards(packages) {
        if (!packages || packages.length === 0) {
            return '<p style="color: #888; font-style: italic; padding: 15px;">No package cards yet. Click "Add New Package Card" to create one.</p>';
        }
        
        let html = '<div class="array-items-container">';
        packages.forEach((pkg, index) => {
            const imageField = createImageUploadField('Image', pkg.image || '', `updatePackageCard(${index}, "image", this.value)`);
            const titleField = createFormField('Title', pkg.title || '', `updatePackageCard(${index}, "title", this.value)`);
            const dimensionsField = createFormField('Dimensions', pkg.dimensions || '', `updatePackageCard(${index}, "dimensions", this.value)`, 'text', 'e.g., 120 Ã— 150 Ã— 150 Ø³ÛŒÙ†Ù¹ÛŒ Ù…ÛŒÙ¹Ø±');
            const button1TextField = createFormField('Button Text', pkg.button1?.text || '', `updatePackageCardButton(${index}, "button1", "text", this.value)`);
            const button1LinkField = createFormField('Button Link', pkg.button1?.link || '', `updatePackageCardButton(${index}, "button1", "link", this.value)`);
            const button2TextField = createFormField('Button Text', pkg.button2?.text || '', `updatePackageCardButton(${index}, "button2", "text", this.value)`);
            const button2LinkField = createFormField('Button Link', pkg.button2?.link || '', `updatePackageCardButton(${index}, "button2", "link", this.value)`);
            
            html += `
                <div class="array-item">
                    <div class="form-group">
                        <label style="font-weight: 600; margin-bottom: 10px;">Package Card ${index + 1}</label>
                        ${imageField.outerHTML}
                        ${titleField.outerHTML}
                        ${dimensionsField.outerHTML}
                        <div class="nested-section" style="margin-top: 15px;">
                            <h5 style="margin-bottom: 10px;">Button 1 (Enquire Now)</h5>
                            ${button1TextField.outerHTML}
                            ${button1LinkField.outerHTML}
                        </div>
                        <div class="nested-section" style="margin-top: 15px;">
                            <h5 style="margin-bottom: 10px;">Button 2 (View More)</h5>
                            ${button2TextField.outerHTML}
                            ${button2LinkField.outerHTML}
                        </div>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removePackageCard(${index})" style="margin-top: 15px;">Remove Card</button>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        return html;
    }

    function addPackageCard() {
        if (!homepageData.packagesSection) homepageData.packagesSection = {};
        if (!homepageData.packagesSection.packages) homepageData.packagesSection.packages = [];
        homepageData.packagesSection.packages.push({
            image: '',
            title: '',
            dimensions: '',
            button1: { text: 'Enquire Now', link: '' },
            button2: { text: 'View More', link: '' }
        });
        renderHomepageContent();
    }

    function removePackageCard(index) {
        if (homepageData.packagesSection?.packages) {
            homepageData.packagesSection.packages.splice(index, 1);
            renderHomepageContent();
        }
    }

    function updatePackageCard(index, field, value) {
        if (homepageData.packagesSection?.packages?.[index]) {
            homepageData.packagesSection.packages[index][field] = value;
        }
    }

    function updatePackageCardButton(index, buttonKey, field, value) {
        if (homepageData.packagesSection?.packages?.[index]) {
            if (!homepageData.packagesSection.packages[index][buttonKey]) {
                homepageData.packagesSection.packages[index][buttonKey] = {};
            }
            homepageData.packagesSection.packages[index][buttonKey][field] = value;
        }
    }

    function renderFurnitureCards(furniture) {
        if (!furniture || furniture.length === 0) {
            return '<p style="color: #888; font-style: italic; padding: 15px;">No furniture cards yet. Click "Add New Furniture Card" to create one.</p>';
        }
        
        let html = '<div class="array-items-container">';
        furniture.forEach((item, index) => {
            const defaultImageField = createImageUploadField('Default Image', item.defaultImage || '', `updateFurnitureCard(${index}, "defaultImage", this.value)`);
            const hoverImageField = createImageUploadField('Hover Image', item.hoverImage || '', `updateFurnitureCard(${index}, "hoverImage", this.value)`);
            const titleField = createFormField('Title', item.title || '', `updateFurnitureCard(${index}, "title", this.value)`);
            const priceField = createFormField('Price', item.price || '', `updateFurnitureCard(${index}, "price", this.value)`, 'text', 'e.g., $15.00 â€“ $20.00');
            const onSaleField = document.createElement('div');
            onSaleField.className = 'form-group';
            onSaleField.innerHTML = `
                <label>
                    <input type="checkbox" ${item.onSale ? 'checked' : ''} onchange="updateFurnitureCard(${index}, 'onSale', this.checked)">
                    On Sale (Show Sale Badge)
                </label>
            `;
            
            html += `
                <div class="array-item">
                    <div class="form-group">
                        <label style="font-weight: 600; margin-bottom: 10px;">Furniture Card ${index + 1}</label>
                        ${defaultImageField.outerHTML}
                        ${hoverImageField.outerHTML}
                        ${titleField.outerHTML}
                        ${priceField.outerHTML}
                        ${onSaleField.outerHTML}
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeFurnitureCard(${index})" style="margin-top: 15px;">Remove Card</button>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        return html;
    }

    function addFurnitureCard() {
        if (!homepageData.furnitureSection) homepageData.furnitureSection = {};
        if (!homepageData.furnitureSection.furniture) homepageData.furnitureSection.furniture = [];
        homepageData.furnitureSection.furniture.push({
            defaultImage: '',
            hoverImage: '',
            title: '',
            price: '',
            onSale: false
        });
        renderHomepageContent();
    }

    function removeFurnitureCard(index) {
        if (homepageData.furnitureSection?.furniture) {
            homepageData.furnitureSection.furniture.splice(index, 1);
            renderHomepageContent();
        }
    }

    function updateFurnitureCard(index, field, value) {
        if (homepageData.furnitureSection?.furniture?.[index]) {
            homepageData.furnitureSection.furniture[index][field] = value;
        }
    }

    function updateProjectType(type, field, value) {
        if (!homepageData.projectsSection) homepageData.projectsSection = {};
        if (!homepageData.projectsSection.projectTypes) homepageData.projectsSection.projectTypes = {};
        if (!homepageData.projectsSection.projectTypes[type]) {
            homepageData.projectsSection.projectTypes[type] = {};
        }
        homepageData.projectsSection.projectTypes[type][field] = value;
    }

    function renderStats(stats) {
        let html = '<div class="array-items-container">';
        stats.forEach((stat, index) => {
            html += `
                <div class="array-item">
                    ${createFormField('Number', stat.number || '', `updateStat(${index}, "number", this.value)`).outerHTML}
                    ${createFormField('Text', stat.text || '', `updateStat(${index}, "text", this.value)`).outerHTML}
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeStat(${index})">Remove</button>
                </div>
            `;
        });
        html += '</div>';
        return html;
    }

    function addStat() {
        if (!homepageData.infoSection) homepageData.infoSection = {};
        if (!homepageData.infoSection.stats) homepageData.infoSection.stats = [];
        homepageData.infoSection.stats.push({ number: '', text: '' });
        renderHomepageContent();
    }

    function removeStat(index) {
        if (homepageData.infoSection?.stats) {
            homepageData.infoSection.stats.splice(index, 1);
            renderHomepageContent();
        }
    }

    function updateStat(index, field, value) {
        if (homepageData.infoSection?.stats?.[index]) {
            homepageData.infoSection.stats[index][field] = value;
        }
    }

    async function saveHomepageData() {
        try {
            // Clean data before saving
            const cleanedData = cleanHomepageData(JSON.parse(JSON.stringify(homepageData)));
            
            const apiBase = getApiBaseUrl();
            
            // Try API first (for local development)
            try {
                const response = await fetch(`${apiBase}/api/homepage`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cleanedData, null, 2)
                });
                if (response.ok) {
                    showAlert('Homepage data saved successfully to server!', 'success');
                    homepageData = cleanedData;
                    return;
                }
            } catch (apiError) {
                // API not available, continue to GitHub API
            }
            
            // Try GitHub API (for Cloudflare Pages)
            const saved = await saveToGitHub('src/_data/homepage.json', cleanedData);
            if (saved) {
                showAlert('Homepage data saved to GitHub! Cloudflare Pages will rebuild automatically.', 'success');
                homepageData = cleanedData;
                return;
            }
            
            // Fallback to download
            downloadJSON('homepage');
            homepageData = cleanedData;
            showAlert('Homepage data downloaded! Upload homepage.json to your repository to save changes.', 'success');
        } catch (error) {
            console.error('Error saving homepage data:', error);
            showAlert('Error saving homepage data: ' + error.message, 'error');
        }
    }

    // DESIGN SERVICES MANAGEMENT
    async function loadDesignServicesData() {
        try {
            const apiBase = getApiBaseUrl();
            let response;
            
            // Try API first (for local development)
            try {
                response = await fetch(`${apiBase}/api/design-services`);
                if (response.ok) {
                    designServicesData = await response.json();
                    renderDesignServicesContent();
                    showAlert('Design services data loaded successfully!', 'success');
                    return;
                }
            } catch (apiError) {
                // API not available, continue to static file fallback
            }
            
            // Try static file paths (for Cloudflare Pages)
            const staticPaths = [
                `${apiBase}/_data/designServices.json`,
                `${apiBase}/src/_data/designServices.json`,
                '/_data/designServices.json',
                '/src/_data/designServices.json',
                `${apiBase}/_data/design-services.json`,
                `${apiBase}/src/_data/design-services.json`,
                '/_data/design-services.json',
                '/src/_data/design-services.json'
            ];
            
            for (const path of staticPaths) {
                try {
                    response = await fetch(path);
                    if (response.ok) {
                        designServicesData = await response.json();
                        renderDesignServicesContent();
                        showAlert('Design services data loaded successfully!', 'success');
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            throw new Error('Could not load design services data from any source');
        } catch (error) {
            console.error('Error loading design services data:', error);
            showAlert('Error loading design services data. Make sure the JSON file exists in your repository.', 'error');
        }
    }

    function renderDesignServicesContent() {
        const container = document.getElementById('design-services-content');
        if (!container) return;
        
        container.innerHTML = '';
        
        // Hero Section
        const hero = designServicesData.hero || {};
        const heroSection = createHomepageSection('Hero Section', 'hero', () => {
            return `
                ${createFormField('Title', hero.title || '', 'updateDesignServicesField("hero", "title", this.value)').outerHTML}
                ${createFormField('Description', hero.description || '', 'updateDesignServicesField("hero", "description", this.value)', 'textarea').outerHTML}
            `;
        });
        container.appendChild(heroSection);
        
        // Services Section
        const servicesSection = designServicesData.servicesSection || {};
        const servicesSectionEl = createHomepageSection('Services Section', 'servicesSection', () => {
            const services = servicesSection.services || [];
            return `
                ${createFormField('Subtitle', servicesSection.subtitle || '', 'updateDesignServicesField("servicesSection", "subtitle", this.value)').outerHTML}
                ${createFormField('Title', servicesSection.title || '', 'updateDesignServicesField("servicesSection", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Service Cards</label>
                    <div id="services-cards-list"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addServiceCard()" style="margin-top: 15px;">+ Add New Service Card</button>
                </div>
            `;
        });
        container.appendChild(servicesSectionEl);
        renderServiceCards(servicesSection.services || []);
        
        // Process Section
        const processSection = designServicesData.processSection || {};
        const processSectionEl = createHomepageSection('Process Section', 'processSection', () => {
            const steps = processSection.steps || [];
            return `
                ${createFormField('Subtitle', processSection.subtitle || '', 'updateDesignServicesField("processSection", "subtitle", this.value)').outerHTML}
                ${createFormField('Title', processSection.title || '', 'updateDesignServicesField("processSection", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Process Steps</label>
                    <div id="process-steps-list"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addProcessStep()" style="margin-top: 15px;">+ Add New Step</button>
                </div>
            `;
        });
        container.appendChild(processSectionEl);
        renderProcessSteps(processSection.steps || []);
        
        // Pricing Section
        const pricingSection = designServicesData.pricingSection || {};
        const pricingSectionEl = createHomepageSection('Pricing Section', 'pricingSection', () => {
            const packages = pricingSection.packages || [];
            return `
                ${createFormField('Subtitle', pricingSection.subtitle || '', 'updateDesignServicesField("pricingSection", "subtitle", this.value)').outerHTML}
                ${createFormField('Title', pricingSection.title || '', 'updateDesignServicesField("pricingSection", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Pricing Packages</label>
                    <div id="pricing-packages-list"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addPricingPackage()" style="margin-top: 15px;">+ Add New Package</button>
                </div>
            `;
        });
        container.appendChild(pricingSectionEl);
        renderPricingPackages(pricingSection.packages || []);
    }

    function updateDesignServicesField(section, field, value) {
        if (!designServicesData[section]) {
            designServicesData[section] = {};
        }
        designServicesData[section][field] = value;
    }

    function renderServiceCards(services) {
        const container = document.getElementById('services-cards-list');
        if (!container) return;
        container.innerHTML = '';
        
        if (services.length === 0) {
            container.innerHTML = '<p style="color: #666; font-style: italic;">No service cards yet. Click "Add New Service Card" to create one.</p>';
            return;
        }
        
        services.forEach((service, index) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <div class="item-card-header">
                    <h3>${service.title || 'Unnamed Service'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="removeServiceCard(${index})">Remove</button>
                </div>
                ${createImageUploadField('Image', service.image || '', `updateServiceCard(${index}, 'image', this.value)`).outerHTML}
                ${createFormField('Icon (Font Awesome)', service.icon || '', `updateServiceCard(${index}, 'icon', this.value)`).outerHTML}
                ${createFormField('Title', service.title || '', `updateServiceCard(${index}, 'title', this.value)`).outerHTML}
                ${createFormField('Description', service.description || '', `updateServiceCard(${index}, 'description', this.value)`, 'textarea').outerHTML}
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Features (${service.features?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="service-features-${index}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addServiceFeature(${index})">+ Add Feature</button>
                    </div>
                </div>
            `;
            container.appendChild(card);
            renderServiceFeatures(index, service.features || []);
        });
    }

    function addServiceCard() {
        if (!designServicesData.servicesSection) designServicesData.servicesSection = {};
        if (!designServicesData.servicesSection.services) designServicesData.servicesSection.services = [];
        designServicesData.servicesSection.services.push({
            image: '',
            icon: 'fas fa-star',
            title: 'New Service',
            description: '',
            features: []
        });
        renderServiceCards(designServicesData.servicesSection.services);
    }

    function removeServiceCard(index) {
        if (confirm('Are you sure you want to remove this service card?')) {
            designServicesData.servicesSection.services.splice(index, 1);
            renderServiceCards(designServicesData.servicesSection.services);
        }
    }

    function updateServiceCard(index, field, value) {
        designServicesData.servicesSection.services[index][field] = value;
    }

    function renderServiceFeatures(serviceIndex, features) {
        const container = document.getElementById(`service-features-${serviceIndex}`);
        if (!container) return;
        container.innerHTML = '';
        features.forEach((feature, featIndex) => {
            const featCard = document.createElement('div');
            featCard.className = 'array-item';
            featCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">Feature ${featIndex + 1}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeServiceFeature(${serviceIndex}, ${featIndex})">Remove</button>
                </div>
                ${createFormField('Feature Text', feature, `updateServiceFeature(${serviceIndex}, ${featIndex}, this.value)`).outerHTML}
            `;
            container.appendChild(featCard);
        });
    }

    function addServiceFeature(serviceIndex) {
        if (!designServicesData.servicesSection.services[serviceIndex].features) {
            designServicesData.servicesSection.services[serviceIndex].features = [];
        }
        designServicesData.servicesSection.services[serviceIndex].features.push('');
        renderServiceFeatures(serviceIndex, designServicesData.servicesSection.services[serviceIndex].features);
    }

    function removeServiceFeature(serviceIndex, featIndex) {
        designServicesData.servicesSection.services[serviceIndex].features.splice(featIndex, 1);
        renderServiceFeatures(serviceIndex, designServicesData.servicesSection.services[serviceIndex].features);
    }

    function updateServiceFeature(serviceIndex, featIndex, value) {
        designServicesData.servicesSection.services[serviceIndex].features[featIndex] = value;
    }

    function renderProcessSteps(steps) {
        const container = document.getElementById('process-steps-list');
        if (!container) return;
        container.innerHTML = '';
        
        if (steps.length === 0) {
            container.innerHTML = '<p style="color: #666; font-style: italic;">No process steps yet. Click "Add New Step" to create one.</p>';
            return;
        }
        
        steps.forEach((step, index) => {
            const stepCard = document.createElement('div');
            stepCard.className = 'item-card';
            stepCard.innerHTML = `
                <div class="item-card-header">
                    <h3>Step ${step.number || index + 1}</h3>
                    <button class="btn btn-danger btn-sm" onclick="removeProcessStep(${index})">Remove</button>
                </div>
                ${createFormField('Number', step.number || '', `updateProcessStep(${index}, 'number', this.value)`).outerHTML}
                ${createFormField('Title', step.title || '', `updateProcessStep(${index}, 'title', this.value)`).outerHTML}
                ${createFormField('Description', step.description || '', `updateProcessStep(${index}, 'description', this.value)`, 'textarea').outerHTML}
            `;
            container.appendChild(stepCard);
        });
    }

    function addProcessStep() {
        if (!designServicesData.processSection) designServicesData.processSection = {};
        if (!designServicesData.processSection.steps) designServicesData.processSection.steps = [];
        const stepNum = String(designServicesData.processSection.steps.length + 1).padStart(2, '0');
        designServicesData.processSection.steps.push({
            number: stepNum,
            title: 'New Step',
            description: ''
        });
        renderProcessSteps(designServicesData.processSection.steps);
    }

    function removeProcessStep(index) {
        if (confirm('Are you sure you want to remove this process step?')) {
            designServicesData.processSection.steps.splice(index, 1);
            renderProcessSteps(designServicesData.processSection.steps);
        }
    }

    function updateProcessStep(index, field, value) {
        designServicesData.processSection.steps[index][field] = value;
    }

    function renderPricingPackages(packages) {
        const container = document.getElementById('pricing-packages-list');
        if (!container) return;
        container.innerHTML = '';
        
        if (packages.length === 0) {
            container.innerHTML = '<p style="color: #666; font-style: italic;">No pricing packages yet. Click "Add New Package" to create one.</p>';
            return;
        }
        
        packages.forEach((pkg, index) => {
            const pkgCard = document.createElement('div');
            pkgCard.className = 'item-card';
            pkgCard.innerHTML = `
                <div class="item-card-header">
                    <h3>${pkg.title || 'Unnamed Package'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="removePricingPackage(${index})">Remove</button>
                </div>
                ${createFormField('Title', pkg.title || '', `updatePricingPackage(${index}, 'title', this.value)`).outerHTML}
                ${createFormField('Price', pkg.price || '', `updatePricingPackage(${index}, 'price', this.value)`).outerHTML}
                ${createFormField('Period', pkg.period || '', `updatePricingPackage(${index}, 'period', this.value)`).outerHTML}
                ${createFormField('Button Text', pkg.buttonText || '', `updatePricingPackage(${index}, 'buttonText', this.value)`).outerHTML}
                <div class="form-group">
                    <label>
                        <input type="checkbox" ${pkg.featured ? 'checked' : ''} onchange="updatePricingPackage(${index}, 'featured', this.checked)">
                        Featured Package
                    </label>
                </div>
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Features (${pkg.features?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="pricing-features-${index}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addPricingFeature(${index})">+ Add Feature</button>
                    </div>
                </div>
            `;
            container.appendChild(pkgCard);
            renderPricingFeatures(index, pkg.features || []);
        });
    }

    function addPricingPackage() {
        if (!designServicesData.pricingSection) designServicesData.pricingSection = {};
        if (!designServicesData.pricingSection.packages) designServicesData.pricingSection.packages = [];
        designServicesData.pricingSection.packages.push({
            title: 'New Package',
            price: '$0',
            period: '',
            features: [],
            buttonText: 'Get Started',
            featured: false
        });
        renderPricingPackages(designServicesData.pricingSection.packages);
    }

    function removePricingPackage(index) {
        if (confirm('Are you sure you want to remove this pricing package?')) {
            designServicesData.pricingSection.packages.splice(index, 1);
            renderPricingPackages(designServicesData.pricingSection.packages);
        }
    }

    function updatePricingPackage(index, field, value) {
        designServicesData.pricingSection.packages[index][field] = value;
    }

    function renderPricingFeatures(pkgIndex, features) {
        const container = document.getElementById(`pricing-features-${pkgIndex}`);
        if (!container) return;
        container.innerHTML = '';
        features.forEach((feature, featIndex) => {
            const featCard = document.createElement('div');
            featCard.className = 'array-item';
            featCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">Feature ${featIndex + 1}</span>
                    <button class="btn btn-danger btn-sm" onclick="removePricingFeature(${pkgIndex}, ${featIndex})">Remove</button>
                </div>
                ${createFormField('Feature Text', feature, `updatePricingFeature(${pkgIndex}, ${featIndex}, this.value)`).outerHTML}
            `;
            container.appendChild(featCard);
        });
    }

    function addPricingFeature(pkgIndex) {
        if (!designServicesData.pricingSection.packages[pkgIndex].features) {
            designServicesData.pricingSection.packages[pkgIndex].features = [];
        }
        designServicesData.pricingSection.packages[pkgIndex].features.push('');
        renderPricingFeatures(pkgIndex, designServicesData.pricingSection.packages[pkgIndex].features);
    }

    function removePricingFeature(pkgIndex, featIndex) {
        designServicesData.pricingSection.packages[pkgIndex].features.splice(featIndex, 1);
        renderPricingFeatures(pkgIndex, designServicesData.pricingSection.packages[pkgIndex].features);
    }

    function updatePricingFeature(pkgIndex, featIndex, value) {
        designServicesData.pricingSection.packages[pkgIndex].features[featIndex] = value;
    }

    async function saveDesignServicesData() {
        try {
            // Clean data before saving
            const cleanedData = cleanDesignServicesData(JSON.parse(JSON.stringify(designServicesData)));
            
            const apiBase = getApiBaseUrl();
            
            // Try API first (for local development)
            try {
                const response = await fetch(`${apiBase}/api/design-services`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cleanedData, null, 2)
                });
                if (response.ok) {
                    showAlert('Design services data saved successfully to server!', 'success');
                    designServicesData = cleanedData;
                    return;
                }
            } catch (apiError) {
                // API not available, continue to GitHub API
            }
            
            // Try GitHub API (for Cloudflare Pages)
            const saved = await saveToGitHub('src/_data/designServices.json', cleanedData);
            if (saved) {
                showAlert('Design services data saved to GitHub! Cloudflare Pages will rebuild automatically.', 'success');
                designServicesData = cleanedData;
                return;
            }
            
            // Fallback to download
            const dataStr = JSON.stringify(cleanedData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'designServices.json';
            link.click();
            URL.revokeObjectURL(url);
            designServicesData = cleanedData;
            showAlert('Design services data downloaded! Upload design-services.json to your repository to save changes.', 'success');
        } catch (error) {
            console.error('Error saving design services data:', error);
            showAlert('Error saving design services data: ' + error.message, 'error');
        }
    }

    // CONTACT MANAGEMENT
    let contactData = {};

    async function loadContactData() {
        try {
            const apiBase = getApiBaseUrl();
            let response;
            
            // Try API first (for local development)
            try {
                response = await fetch(`${apiBase}/api/contact`);
                if (response.ok) {
                    contactData = await response.json();
                    renderContactContent();
                    showAlert('Contact data loaded successfully!', 'success');
                    return;
                }
            } catch (apiError) {
                // API not available, continue to static file fallback
            }
            
            // Try static file paths (for Cloudflare Pages)
            const staticPaths = [
                `${apiBase}/_data/contact.json`,
                `${apiBase}/src/_data/contact.json`,
                '/_data/contact.json',
                '/src/_data/contact.json'
            ];
            
            for (const path of staticPaths) {
                try {
                    response = await fetch(path);
                    if (response.ok) {
                        contactData = await response.json();
                        renderContactContent();
                        showAlert('Contact data loaded successfully!', 'success');
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            throw new Error('Could not load contact data from any source');
        } catch (error) {
            console.error('Error loading contact data:', error);
            showAlert('Error loading contact data. Make sure the JSON file exists in your repository.', 'error');
        }
    }

    function renderContactContent() {
        const container = document.getElementById('contact-content');
        if (!container) return;
        
        container.innerHTML = '';
        
        // Hero Section
        const hero = contactData.hero || {};
        const heroSection = createHomepageSection('Hero Section', 'hero', () => {
            return `
                ${createFormField('Title', hero.title || '', 'updateContactField("hero", "title", this.value)').outerHTML}
                ${createFormField('Description', hero.description || '', 'updateContactField("hero", "description", this.value)', 'textarea').outerHTML}
            `;
        });
        container.appendChild(heroSection);
        
        // Header Section
        const header = contactData.header || {};
        const headerSection = createHomepageSection('Header Section', 'header', () => {
            return `
                ${createFormField('Title', header.title || '', 'updateContactField("header", "title", this.value)').outerHTML}
                ${createFormField('Description', header.description || '', 'updateContactField("header", "description", this.value)', 'textarea').outerHTML}
            `;
        });
        container.appendChild(headerSection);
        
        // Form Section
        const formSection = contactData.formSection || {};
        const formSectionEl = createHomepageSection('Form Section', 'formSection', () => {
            return `
                ${createFormField('Title', formSection.title || '', 'updateContactField("formSection", "title", this.value)').outerHTML}
            `;
        });
        container.appendChild(formSectionEl);
        
        // Info Section
        const infoSection = contactData.infoSection || {};
        const infoSectionEl = createHomepageSection('Contact Information Section', 'infoSection', () => {
            const items = infoSection.items || [];
            return `
                ${createFormField('Section Title', infoSection.title || '', 'updateContactField("infoSection", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Contact Info Items</label>
                    <div id="contact-info-items-list"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addContactInfoItem()" style="margin-top: 15px;">+ Add New Info Item</button>
                </div>
            `;
        });
        container.appendChild(infoSectionEl);
        renderContactInfoItems(infoSection.items || []);
        
        // Business Hours Section
        const businessHours = contactData.businessHours || {};
        const hoursSectionEl = createHomepageSection('Business Hours Section', 'businessHours', () => {
            const hours = businessHours.hours || [];
            return `
                ${createFormField('Section Title', businessHours.title || '', 'updateContactField("businessHours", "title", this.value)').outerHTML}
                <div class="form-group" style="margin-top: 25px;">
                    <label style="font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.1rem;">Business Hours</label>
                    <div id="business-hours-list"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addBusinessHour()" style="margin-top: 15px;">+ Add New Hour</button>
                </div>
            `;
        });
        container.appendChild(hoursSectionEl);
        renderBusinessHours(businessHours.hours || []);
        
        // Map Section
        const map = contactData.map || {};
        const mapSectionEl = createHomepageSection('Map Section', 'map', () => {
            return `
                ${createFormField('Google Maps Embed URL', map.embedUrl || '', 'updateContactField("map", "embedUrl", this.value)', 'textarea').outerHTML}
            `;
        });
        container.appendChild(mapSectionEl);
    }

    function updateContactField(section, field, value) {
        if (!contactData[section]) {
            contactData[section] = {};
        }
        contactData[section][field] = value;
    }

    function renderContactInfoItems(items) {
        const container = document.getElementById('contact-info-items-list');
        if (!container) return;
        container.innerHTML = '';
        
        if (items.length === 0) {
            container.innerHTML = '<p style="color: #666; font-style: italic;">No contact info items yet. Click "Add New Info Item" to create one.</p>';
            return;
        }
        
        items.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <div class="item-card-header">
                    <h3>${item.label || 'Unnamed Item'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="removeContactInfoItem(${index})">Remove</button>
                </div>
                ${createFormField('Icon (Font Awesome)', item.icon || '', `updateContactInfoItem(${index}, 'icon', this.value)`).outerHTML}
                ${createFormField('Label', item.label || '', `updateContactInfoItem(${index}, 'label', this.value)`).outerHTML}
                ${createFormField('Value', item.value || '', `updateContactInfoItem(${index}, 'value', this.value)`).outerHTML}
            `;
            container.appendChild(card);
        });
    }

    function addContactInfoItem() {
        if (!contactData.infoSection) contactData.infoSection = {};
        if (!contactData.infoSection.items) contactData.infoSection.items = [];
        contactData.infoSection.items.push({
            icon: 'fas fa-circle',
            label: 'New Item',
            value: ''
        });
        renderContactInfoItems(contactData.infoSection.items);
    }

    function removeContactInfoItem(index) {
        if (confirm('Are you sure you want to remove this contact info item?')) {
            contactData.infoSection.items.splice(index, 1);
            renderContactInfoItems(contactData.infoSection.items);
        }
    }

    function updateContactInfoItem(index, field, value) {
        contactData.infoSection.items[index][field] = value;
    }

    function renderBusinessHours(hours) {
        const container = document.getElementById('business-hours-list');
        if (!container) return;
        container.innerHTML = '';
        
        if (hours.length === 0) {
            container.innerHTML = '<p style="color: #666; font-style: italic;">No business hours yet. Click "Add New Hour" to create one.</p>';
            return;
        }
        
        hours.forEach((hour, index) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <div class="item-card-header">
                    <h3>${hour.day || 'Unnamed Day'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="removeBusinessHour(${index})">Remove</button>
                </div>
                ${createFormField('Day', hour.day || '', `updateBusinessHour(${index}, 'day', this.value)`).outerHTML}
                ${createFormField('Time', hour.time || '', `updateBusinessHour(${index}, 'time', this.value)`).outerHTML}
            `;
            container.appendChild(card);
        });
    }

    function addBusinessHour() {
        if (!contactData.businessHours) contactData.businessHours = {};
        if (!contactData.businessHours.hours) contactData.businessHours.hours = [];
        contactData.businessHours.hours.push({
            day: 'Monday',
            time: '9:00 am - 5:00 pm'
        });
        renderBusinessHours(contactData.businessHours.hours);
    }

    function removeBusinessHour(index) {
        if (confirm('Are you sure you want to remove this business hour?')) {
            contactData.businessHours.hours.splice(index, 1);
            renderBusinessHours(contactData.businessHours.hours);
        }
    }

    function updateBusinessHour(index, field, value) {
        contactData.businessHours.hours[index][field] = value;
    }

    async function saveContactData() {
        try {
            // Clean data before saving
            const cleanedData = cleanContactData(JSON.parse(JSON.stringify(contactData)));
            
            const apiBase = getApiBaseUrl();
            
            // Try API first (for local development)
            try {
                const response = await fetch(`${apiBase}/api/contact`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cleanedData, null, 2)
                });
                if (response.ok) {
                    showAlert('Contact data saved successfully to server!', 'success');
                    contactData = cleanedData;
                    return;
                }
            } catch (apiError) {
                // API not available, continue to GitHub API
            }
            
            // Try GitHub API (for Cloudflare Pages)
            const saved = await saveToGitHub('src/_data/contact.json', cleanedData);
            if (saved) {
                showAlert('Contact data saved to GitHub! Cloudflare Pages will rebuild automatically.', 'success');
                contactData = cleanedData;
                return;
            }
            
            // Fallback to download
            const dataStr = JSON.stringify(cleanedData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'contact.json';
            link.click();
            URL.revokeObjectURL(url);
            contactData = cleanedData;
            showAlert('Contact data downloaded! Upload contact.json to your repository to save changes.', 'success');
        } catch (error) {
            console.error('Error saving contact data:', error);
            showAlert('Error saving contact data: ' + error.message, 'error');
        }
    }

    // PACKAGES MANAGEMENT
    async function loadPackagesData() {
        try {
            const apiBase = getApiBaseUrl();
            let response;
            
            // Try API first (for local development)
            try {
                response = await fetch(`${apiBase}/api/packages`);
                if (response.ok) {
                    packagesData = await response.json();
                    renderPackagesList();
                    showAlert('Packages data loaded successfully!', 'success');
                    return;
                }
            } catch (apiError) {
                // API not available, continue to static file fallback
            }
            
            // Try static file paths (for Cloudflare Pages)
            const staticPaths = [
                `${apiBase}/_data/packages.json`,
                `${apiBase}/src/_data/packages.json`,
                '/_data/packages.json',
                '/src/_data/packages.json'
            ];
            
            for (const path of staticPaths) {
                try {
                    response = await fetch(path);
                    if (response.ok) {
                        packagesData = await response.json();
                        renderPackagesList();
                        showAlert('Packages data loaded successfully!', 'success');
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            throw new Error('Could not load packages data from any source');
        } catch (error) {
            console.error('Error loading packages data:', error);
            showAlert('Error loading packages data. Make sure the JSON file exists in your repository.', 'error');
        }
    }

    function renderPackagesList() {
        const container = document.getElementById('packages-list');
        container.innerHTML = '';
        
        if (!packagesData.packages || packagesData.packages.length === 0) {
            container.innerHTML = '<p>No packages found. Add your first package!</p>';
            return;
        }

        packagesData.packages.forEach((pkg, pkgIndex) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            
            let html = `
                <div class="item-card-header">
                    <h3>${pkg.name || 'Unnamed Package'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="deletePackage(${pkgIndex})">Delete</button>
                </div>
                ${createFormField('Name', pkg.name, `updatePackageField(${pkgIndex}, 'name', this.value)`).outerHTML}
                ${createFormField('Slug', pkg.slug, `updatePackageField(${pkgIndex}, 'slug', this.value)`).outerHTML}
                <div class="form-row">
                    ${createFormField('Current Price', pkg.currentPrice, `updatePackageField(${pkgIndex}, 'currentPrice', this.value)`).outerHTML}
                    ${createFormField('Original Price', pkg.originalPrice, `updatePackageField(${pkgIndex}, 'originalPrice', this.value)`).outerHTML}
                </div>
                <div class="form-row">
                    ${createFormField('Sale Percentage', pkg.salePercentage, `updatePackageField(${pkgIndex}, 'salePercentage', this.value)`).outerHTML}
                    ${createFormField('Delivery Time', pkg.deliveryTime, `updatePackageField(${pkgIndex}, 'deliveryTime', this.value)`).outerHTML}
                </div>
                <div class="form-row">
                    ${createFormField('Rating', pkg.rating, `updatePackageField(${pkgIndex}, 'rating', this.value)`, 'number').outerHTML}
                    ${createFormField('Review Count', pkg.reviewCount, `updatePackageField(${pkgIndex}, 'reviewCount', this.value)`, 'number').outerHTML}
                </div>
                <div class="form-row">
                    ${createFormField('Default Color', pkg.defaultColor, `updatePackageField(${pkgIndex}, 'defaultColor', this.value)`).outerHTML}
                    ${createFormField('Default Room Type', pkg.defaultRoomType, `updatePackageField(${pkgIndex}, 'defaultRoomType', this.value)`).outerHTML}
                </div>
                ${createFormField('Description', pkg.description, `updatePackageField(${pkgIndex}, 'description', this.value)`, 'textarea').outerHTML}
            `;

            // Colors section
            html += `
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Colors (${pkg.colors?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="colors-${pkgIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addPackageColor(${pkgIndex})">+ Add Color</button>
                    </div>
                </div>
            `;

            // Room Types section
            html += `
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Room Types (${pkg.roomTypes?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="roomtypes-${pkgIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addPackageRoomType(${pkgIndex})">+ Add Room Type</button>
                    </div>
                </div>
            `;

            // Features section
            html += `
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Features (${pkg.features?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="features-${pkgIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addPackageFeature(${pkgIndex})">+ Add Feature</button>
                    </div>
                </div>
            `;

            card.innerHTML = html;
            container.appendChild(card);
            
            // Images section (rendered separately to properly bind events)
            const imagesSection = document.createElement('div');
            imagesSection.className = 'nested-section';
            imagesSection.innerHTML = `
                <h4 class="collapsible" onclick="toggleCollapsible(this)">Package Images (${pkg.images?.length || 0})</h4>
                <div class="collapsible-content" id="package-images-${pkgIndex}"></div>
            `;
            card.appendChild(imagesSection);
            const imagesContainer = document.getElementById(`package-images-${pkgIndex}`);
            const imagesField = createImageArrayField('Images', pkg.images || [], 
                (url) => addPackageImage(pkgIndex, url),
                (index) => removePackageImage(pkgIndex, index)
            );
            imagesContainer.appendChild(imagesField);

            // Render colors
            renderPackageColors(pkgIndex, pkg.colors || []);
            // Render room types
            renderPackageRoomTypes(pkgIndex, pkg.roomTypes || []);
            // Render features
            renderPackageFeatures(pkgIndex, pkg.features || []);
        });
    }

    function renderPackageColors(pkgIndex, colors) {
        const container = document.getElementById(`colors-${pkgIndex}`);
        container.innerHTML = '';
        colors.forEach((color, colorIndex) => {
            const colorCard = document.createElement('div');
            colorCard.className = 'array-item';
            colorCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">Color: ${color.name || 'Unnamed'}</span>
                    <button class="btn btn-danger btn-sm" onclick="removePackageColor(${pkgIndex}, ${colorIndex})">Remove</button>
                </div>
                ${createFormField('Name', color.name, `updatePackageColor(${pkgIndex}, ${colorIndex}, 'name', this.value)`).outerHTML}
                ${createFormField('Hex Code', color.hex, `updatePackageColor(${pkgIndex}, ${colorIndex}, 'hex', this.value)`).outerHTML}
                <div class="form-row">
                    ${createFormField('Current Price', color.currentPrice, `updatePackageColor(${pkgIndex}, ${colorIndex}, 'currentPrice', this.value)`).outerHTML}
                    ${createFormField('Original Price', color.originalPrice, `updatePackageColor(${pkgIndex}, ${colorIndex}, 'originalPrice', this.value)`).outerHTML}
                </div>
                ${createFormField('Sale Percentage', color.salePercentage, `updatePackageColor(${pkgIndex}, ${colorIndex}, 'salePercentage', this.value)`).outerHTML}
                <div id="color-images-${pkgIndex}-${colorIndex}"></div>
            `;
            container.appendChild(colorCard);
            
            // Render color images separately
            const colorImagesContainer = document.getElementById(`color-images-${pkgIndex}-${colorIndex}`);
            const colorImagesField = createImageArrayField('Color Images', color.images || [], 
                (url) => addPackageColorImage(pkgIndex, colorIndex, url),
                (index) => removePackageColorImage(pkgIndex, colorIndex, index)
            );
            colorImagesContainer.appendChild(colorImagesField);
        });
    }

    function renderPackageRoomTypes(pkgIndex, roomTypes) {
        const container = document.getElementById(`roomtypes-${pkgIndex}`);
        container.innerHTML = '';
        roomTypes.forEach((roomType, rtIndex) => {
            const rtCard = document.createElement('div');
            rtCard.className = 'array-item';
            rtCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">${roomType.name || 'Unnamed Room Type'}</span>
                    <button class="btn btn-danger btn-sm" onclick="removePackageRoomType(${pkgIndex}, ${rtIndex})">Remove</button>
                </div>
                ${createFormField('Name', roomType.name, `updatePackageRoomType(${pkgIndex}, ${rtIndex}, 'name', this.value)`).outerHTML}
                <div class="form-group">
                    <label>
                        <input type="checkbox" ${roomType.active ? 'checked' : ''} 
                               onchange="updatePackageRoomType(${pkgIndex}, ${rtIndex}, 'active', this.checked)">
                        Active
                    </label>
                </div>
                <div class="form-row">
                    ${createFormField('Current Price', roomType.currentPrice, `updatePackageRoomType(${pkgIndex}, ${rtIndex}, 'currentPrice', this.value)`).outerHTML}
                    ${createFormField('Original Price', roomType.originalPrice, `updatePackageRoomType(${pkgIndex}, ${rtIndex}, 'originalPrice', this.value)`).outerHTML}
                </div>
                ${createFormField('Sale Percentage', roomType.salePercentage, `updatePackageRoomType(${pkgIndex}, ${rtIndex}, 'salePercentage', this.value)`).outerHTML}
                <div id="roomtype-images-${pkgIndex}-${rtIndex}"></div>
            `;
            container.appendChild(rtCard);
            
            // Render room type images separately
            const rtImagesContainer = document.getElementById(`roomtype-images-${pkgIndex}-${rtIndex}`);
            const rtImagesField = createImageArrayField('Room Type Images', roomType.images || [], 
                (url) => addPackageRoomTypeImage(pkgIndex, rtIndex, url),
                (index) => removePackageRoomTypeImage(pkgIndex, rtIndex, index)
            );
            rtImagesContainer.appendChild(rtImagesField);
        });
    }

    function renderPackageFeatures(pkgIndex, features) {
        const container = document.getElementById(`features-${pkgIndex}`);
        container.innerHTML = '';
        features.forEach((feature, featIndex) => {
            const featCard = document.createElement('div');
            featCard.className = 'array-item';
            featCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">Feature ${featIndex + 1}</span>
                    <button class="btn btn-danger btn-sm" onclick="removePackageFeature(${pkgIndex}, ${featIndex})">Remove</button>
                </div>
                ${createFormField('Feature Text', feature, `updatePackageFeature(${pkgIndex}, ${featIndex}, this.value)`, 'textarea').outerHTML}
            `;
            container.appendChild(featCard);
        });
    }

    function updatePackageField(pkgIndex, field, value) {
        if (!packagesData.packages[pkgIndex]) return;
        if (field === 'rating' || field === 'reviewCount') {
            packagesData.packages[pkgIndex][field] = parseInt(value) || 0;
        } else {
            packagesData.packages[pkgIndex][field] = value;
        }
    }

    function addPackageColor(pkgIndex) {
        if (!packagesData.packages[pkgIndex].colors) packagesData.packages[pkgIndex].colors = [];
        packagesData.packages[pkgIndex].colors.push({
            name: 'New Color',
            hex: '#ffffff',
            currentPrice: '0.00',
            originalPrice: '0.00',
            salePercentage: '0% OFF',
            images: []
        });
        renderPackageColors(pkgIndex, packagesData.packages[pkgIndex].colors);
    }

    function removePackageColor(pkgIndex, colorIndex) {
        packagesData.packages[pkgIndex].colors.splice(colorIndex, 1);
        renderPackageColors(pkgIndex, packagesData.packages[pkgIndex].colors);
    }

    function updatePackageColor(pkgIndex, colorIndex, field, value) {
        packagesData.packages[pkgIndex].colors[colorIndex][field] = value;
    }

    function addPackageColorImage(pkgIndex, colorIndex, url) {
        if (!url) return;
        if (!packagesData.packages[pkgIndex].colors[colorIndex].images) {
            packagesData.packages[pkgIndex].colors[colorIndex].images = [];
        }
        packagesData.packages[pkgIndex].colors[colorIndex].images.push(url);
        // Re-render just the image field for this color
        const container = document.getElementById(`color-images-${pkgIndex}-${colorIndex}`);
        container.innerHTML = '';
        const imagesField = createImageArrayField('Color Images', packagesData.packages[pkgIndex].colors[colorIndex].images || [], 
            (url) => addPackageColorImage(pkgIndex, colorIndex, url),
            (index) => removePackageColorImage(pkgIndex, colorIndex, index)
        );
        container.appendChild(imagesField);
    }

    function removePackageColorImage(pkgIndex, colorIndex, imageIndex) {
        packagesData.packages[pkgIndex].colors[colorIndex].images.splice(imageIndex, 1);
        // Re-render just the image field for this color
        const container = document.getElementById(`color-images-${pkgIndex}-${colorIndex}`);
        container.innerHTML = '';
        const imagesField = createImageArrayField('Color Images', packagesData.packages[pkgIndex].colors[colorIndex].images || [], 
            (url) => addPackageColorImage(pkgIndex, colorIndex, url),
            (index) => removePackageColorImage(pkgIndex, colorIndex, index)
        );
        container.appendChild(imagesField);
    }

    function addPackageRoomType(pkgIndex) {
        if (!packagesData.packages[pkgIndex].roomTypes) packagesData.packages[pkgIndex].roomTypes = [];
        packagesData.packages[pkgIndex].roomTypes.push({
            name: 'New Room Type',
            active: false,
            currentPrice: '0.00',
            originalPrice: '0.00',
            salePercentage: '0% OFF',
            images: []
        });
        renderPackageRoomTypes(pkgIndex, packagesData.packages[pkgIndex].roomTypes);
    }

    function removePackageRoomType(pkgIndex, rtIndex) {
        packagesData.packages[pkgIndex].roomTypes.splice(rtIndex, 1);
        renderPackageRoomTypes(pkgIndex, packagesData.packages[pkgIndex].roomTypes);
    }

    function updatePackageRoomType(pkgIndex, rtIndex, field, value) {
        packagesData.packages[pkgIndex].roomTypes[rtIndex][field] = value;
    }

    function addPackageRoomTypeImage(pkgIndex, rtIndex, url) {
        if (!url) return;
        if (!packagesData.packages[pkgIndex].roomTypes[rtIndex].images) {
            packagesData.packages[pkgIndex].roomTypes[rtIndex].images = [];
        }
        packagesData.packages[pkgIndex].roomTypes[rtIndex].images.push(url);
        // Re-render just the image field for this room type
        const container = document.getElementById(`roomtype-images-${pkgIndex}-${rtIndex}`);
        container.innerHTML = '';
        const imagesField = createImageArrayField('Room Type Images', packagesData.packages[pkgIndex].roomTypes[rtIndex].images || [], 
            (url) => addPackageRoomTypeImage(pkgIndex, rtIndex, url),
            (index) => removePackageRoomTypeImage(pkgIndex, rtIndex, index)
        );
        container.appendChild(imagesField);
    }

    function removePackageRoomTypeImage(pkgIndex, rtIndex, imageIndex) {
        packagesData.packages[pkgIndex].roomTypes[rtIndex].images.splice(imageIndex, 1);
        // Re-render just the image field for this room type
        const container = document.getElementById(`roomtype-images-${pkgIndex}-${rtIndex}`);
        container.innerHTML = '';
        const imagesField = createImageArrayField('Room Type Images', packagesData.packages[pkgIndex].roomTypes[rtIndex].images || [], 
            (url) => addPackageRoomTypeImage(pkgIndex, rtIndex, url),
            (index) => removePackageRoomTypeImage(pkgIndex, rtIndex, index)
        );
        container.appendChild(imagesField);
    }

    function addPackageFeature(pkgIndex) {
        if (!packagesData.packages[pkgIndex].features) packagesData.packages[pkgIndex].features = [];
        packagesData.packages[pkgIndex].features.push('New feature');
        renderPackageFeatures(pkgIndex, packagesData.packages[pkgIndex].features);
    }

    function removePackageFeature(pkgIndex, featIndex) {
        packagesData.packages[pkgIndex].features.splice(featIndex, 1);
        renderPackageFeatures(pkgIndex, packagesData.packages[pkgIndex].features);
    }

    function updatePackageFeature(pkgIndex, featIndex, value) {
        packagesData.packages[pkgIndex].features[featIndex] = value;
    }

    function addPackageImage(pkgIndex, url) {
        if (!url) return;
        if (!packagesData.packages[pkgIndex].images) packagesData.packages[pkgIndex].images = [];
        packagesData.packages[pkgIndex].images.push(url);
        // Re-render just the image field
        const container = document.getElementById(`package-images-${pkgIndex}`);
        container.innerHTML = '';
        const imagesField = createImageArrayField('Images', packagesData.packages[pkgIndex].images || [], 
            (url) => addPackageImage(pkgIndex, url),
            (index) => removePackageImage(pkgIndex, index)
        );
        container.appendChild(imagesField);
    }

    function removePackageImage(pkgIndex, imageIndex) {
        packagesData.packages[pkgIndex].images.splice(imageIndex, 1);
        // Re-render just the image field
        const container = document.getElementById(`package-images-${pkgIndex}`);
        container.innerHTML = '';
        const imagesField = createImageArrayField('Images', packagesData.packages[pkgIndex].images || [], 
            (url) => addPackageImage(pkgIndex, url),
            (index) => removePackageImage(pkgIndex, index)
        );
        container.appendChild(imagesField);
    }

    function addPackage() {
        if (!packagesData.packages) packagesData.packages = [];
        packagesData.packages.push({
            slug: 'new-package-' + Date.now(),
            name: 'New Package',
            currentPrice: '0.00',
            originalPrice: '0.00',
            salePercentage: '0% OFF',
            deliveryTime: '7-10 days',
            rating: 5,
            reviewCount: 0,
            defaultColor: 'White',
            defaultRoomType: '1 Bedroom/15 Items',
            colors: [],
            roomTypes: [],
            images: [],
            description: '',
            features: []
        });
        renderPackagesList();
    }

    function deletePackage(index) {
        if (confirm('Are you sure you want to delete this package?')) {
            packagesData.packages.splice(index, 1);
            renderPackagesList();
        }
    }

    // Download dropdown toggle
    function toggleDownloadDropdown() {
        const dropdown = document.getElementById('downloadDropdown');
        dropdown.classList.toggle('show');
    }

    // Close dropdown when clicking outside
    window.onclick = function(event) {
        if (!event.target.matches('.download-btn') && !event.target.closest('.download-dropdown')) {
            const dropdown = document.getElementById('downloadDropdown');
            if (dropdown && dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            }
        }
    }

    // Download JSON file function
    function downloadJSON(type) {
        let data, filename;
        
        switch(type) {
            case 'packages':
                data = packagesData;
                filename = 'packages.json';
                break;
            case 'products':
                data = productsData;
                filename = 'products.json';
                break;
            case 'furniture':
                data = furnitureData;
                filename = 'furniture.json';
                break;
            case 'projects':
                data = projectsData;
                filename = 'projects.json';
                break;
            case 'design-services':
                data = designServicesData;
                filename = 'designServices.json';
                break;
            case 'contact':
                data = contactData;
                filename = 'contact.json';
                break;
            case 'homepage':
                data = homepageData;
                filename = 'homepage.json';
                break;
            default:
                showAlert('Invalid file type', 'error');
                return;
        }

        // Check if data is loaded
        if (!data || (Array.isArray(data) && data.length === 0) || 
            (typeof data === 'object' && Object.keys(data).length === 0)) {
            showAlert(`Please load ${type} data first before downloading.`, 'error');
            return;
        }

        // Create blob and download
        const jsonString = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showAlert(`${filename} downloaded successfully!`, 'success');
        toggleDownloadDropdown(); // Close dropdown
    }

    async function savePackagesData() {
        try {
            // Clean data before saving
            const cleanedData = cleanPackagesData(JSON.parse(JSON.stringify(packagesData)));
            
            // Try to save via API first (for local development)
            const apiBase = getApiBaseUrl();
            try {
                const response = await fetch(`${apiBase}/api/packages`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cleanedData, null, 2)
                });
                if (response.ok) {
                    showAlert('Packages data saved successfully to server!', 'success');
                    packagesData = cleanedData;
                    return;
                }
            } catch (apiError) {
                // API not available, try GitHub API
            }
            
            // Try GitHub API for Cloudflare Pages
            const saved = await saveToGitHub('src/_data/packages.json', cleanedData);
            if (saved) {
                showAlert('Packages data saved to GitHub! Cloudflare Pages will rebuild automatically.', 'success');
                packagesData = cleanedData;
                return;
            }
            
            // Fallback: download the file
            downloadJSON('packages');
            packagesData = cleanedData;
            showAlert('Packages data downloaded! Upload packages.json to your repository to save changes.', 'success');
        } catch (error) {
            showAlert('Error saving packages data: ' + error.message, 'error');
        }
    }

    // PRODUCTS MANAGEMENT
    async function loadProductsData() {
        try {
            const apiBase = getApiBaseUrl();
            let response;
            
            // Try API first (for local development)
            try {
                response = await fetch(`${apiBase}/api/products`);
                if (response.ok) {
                    productsData = await response.json();
                    renderProductsList();
                    showAlert('Products data loaded successfully!', 'success');
                    return;
                }
            } catch (apiError) {
                // API not available, continue to static file fallback
            }
            
            // Try static file paths (for Cloudflare Pages)
            const staticPaths = [
                `${apiBase}/_data/products.json`,
                `${apiBase}/src/_data/products.json`,
                '/_data/products.json',
                '/src/_data/products.json'
            ];
            
            for (const path of staticPaths) {
                try {
                    response = await fetch(path);
                    if (response.ok) {
                        productsData = await response.json();
                        renderProductsList();
                        showAlert('Products data loaded successfully!', 'success');
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            throw new Error('Could not load products data from any source');
        } catch (error) {
            console.error('Error loading products data:', error);
            showAlert('Error loading products data. Make sure the JSON file exists in your repository.', 'error');
        }
    }

    function renderProductsList() {
        const container = document.getElementById('products-list');
        container.innerHTML = '';
        
        if (!productsData.products || productsData.products.length === 0) {
            container.innerHTML = '<p>No products found. Add your first product!</p>';
            return;
        }

        productsData.products.forEach((product, prodIndex) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            
            card.innerHTML = `
                <div class="item-card-header">
                    <h3>${product.name || 'Unnamed Product'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="deleteProduct(${prodIndex})">Delete</button>
                </div>
                ${createFormField('ID', product.id, `updateProductField(${prodIndex}, 'id', this.value)`).outerHTML}
                ${createFormField('Name', product.name, `updateProductField(${prodIndex}, 'name', this.value)`).outerHTML}
                ${createFormField('Slug', product.slug, `updateProductField(${prodIndex}, 'slug', this.value)`).outerHTML}
                ${createFormField('Category', product.category, `updateProductField(${prodIndex}, 'category', this.value)`).outerHTML}
                <div class="form-row">
                    ${createFormField('Price', product.price, `updateProductField(${prodIndex}, 'price', this.value)`).outerHTML}
                    ${createFormField('Currency', product.currency, `updateProductField(${prodIndex}, 'currency', this.value)`).outerHTML}
                </div>
                <div class="form-row">
                    ${createFormField('Color', product.color, `updateProductField(${prodIndex}, 'color', this.value)`).outerHTML}
                    ${createFormField('Color Code', product.colorCode, `updateProductField(${prodIndex}, 'colorCode', this.value)`).outerHTML}
                </div>
                ${createFormField('Description', product.description, `updateProductField(${prodIndex}, 'description', this.value)`, 'textarea').outerHTML}
                ${createFormField('Features', product.features, `updateProductField(${prodIndex}, 'features', this.value)`, 'textarea').outerHTML}
                <div class="form-row">
                    ${createFormField('Delivery Days', product.deliveryDays, `updateProductField(${prodIndex}, 'deliveryDays', this.value)`, 'number').outerHTML}
                    ${createFormField('Monthly Payment', product.monthlyPayment, `updateProductField(${prodIndex}, 'monthlyPayment', this.value)`).outerHTML}
                </div>
                ${createFormField('Installment Payment', product.installmentPayment, `updateProductField(${prodIndex}, 'installmentPayment', this.value)`).outerHTML}
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Color Options (${product.colorOptions?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="coloroptions-${prodIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addProductColorOption(${prodIndex})">+ Add Color Option</button>
                    </div>
                </div>
            `;
            container.appendChild(card);
            renderProductColorOptions(prodIndex, product.colorOptions || []);
        });
    }

    function renderProductColorOptions(prodIndex, colorOptions) {
        const container = document.getElementById(`coloroptions-${prodIndex}`);
        container.innerHTML = '';
        colorOptions.forEach((colorOpt, coIndex) => {
            const coCard = document.createElement('div');
            coCard.className = 'array-item';
            coCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">${colorOpt.name || 'Unnamed Color'}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeProductColorOption(${prodIndex}, ${coIndex})">Remove</button>
                </div>
                ${createFormField('Name', colorOpt.name, `updateProductColorOption(${prodIndex}, ${coIndex}, 'name', this.value)`).outerHTML}
                ${createFormField('Code', colorOpt.code, `updateProductColorOption(${prodIndex}, ${coIndex}, 'code', this.value)`).outerHTML}
                <div class="form-row">
                    ${createFormField('Price', colorOpt.price, `updateProductColorOption(${prodIndex}, ${coIndex}, 'price', this.value)`).outerHTML}
                    ${createFormField('Original Price', colorOpt.originalPrice, `updateProductColorOption(${prodIndex}, ${coIndex}, 'originalPrice', this.value)`).outerHTML}
                </div>
                ${createFormField('Sale Percentage', colorOpt.salePercentage, `updateProductColorOption(${prodIndex}, ${coIndex}, 'salePercentage', this.value)`).outerHTML}
                ${createFormField('Image', colorOpt.image, `updateProductColorOption(${prodIndex}, ${coIndex}, 'image', this.value)`).outerHTML}
                <div id="product-gallery-${prodIndex}-${coIndex}"></div>
            `;
            container.appendChild(coCard);
            
            // Render gallery separately
            const galleryContainer = document.getElementById(`product-gallery-${prodIndex}-${coIndex}`);
            const galleryField = createImageArrayField('Gallery', colorOpt.gallery || [], 
                (url) => addProductColorOptionGallery(prodIndex, coIndex, url),
                (index) => removeProductColorOptionGallery(prodIndex, coIndex, index)
            );
            galleryContainer.appendChild(galleryField);
        });
    }

    function updateProductField(prodIndex, field, value) {
        if (field === 'deliveryDays') {
            productsData.products[prodIndex][field] = parseInt(value) || 0;
        } else {
            productsData.products[prodIndex][field] = value;
        }
    }

    function addProductColorOption(prodIndex) {
        if (!productsData.products[prodIndex].colorOptions) productsData.products[prodIndex].colorOptions = [];
        productsData.products[prodIndex].colorOptions.push({
            name: 'New Color',
            code: '#ffffff',
            price: '0.00',
            originalPrice: '0.00',
            salePercentage: '0% OFF',
            image: '',
            gallery: []
        });
        renderProductColorOptions(prodIndex, productsData.products[prodIndex].colorOptions);
    }

    function removeProductColorOption(prodIndex, coIndex) {
        productsData.products[prodIndex].colorOptions.splice(coIndex, 1);
        renderProductColorOptions(prodIndex, productsData.products[prodIndex].colorOptions);
    }

    function updateProductColorOption(prodIndex, coIndex, field, value) {
        productsData.products[prodIndex].colorOptions[coIndex][field] = value;
    }

    function addProductColorOptionGallery(prodIndex, coIndex, url) {
        if (!url) return;
        if (!productsData.products[prodIndex].colorOptions[coIndex].gallery) {
            productsData.products[prodIndex].colorOptions[coIndex].gallery = [];
        }
        productsData.products[prodIndex].colorOptions[coIndex].gallery.push(url);
        // Re-render just the gallery field
        const container = document.getElementById(`product-gallery-${prodIndex}-${coIndex}`);
        container.innerHTML = '';
        const galleryField = createImageArrayField('Gallery', productsData.products[prodIndex].colorOptions[coIndex].gallery || [], 
            (url) => addProductColorOptionGallery(prodIndex, coIndex, url),
            (index) => removeProductColorOptionGallery(prodIndex, coIndex, index)
        );
        container.appendChild(galleryField);
    }

    function removeProductColorOptionGallery(prodIndex, coIndex, galleryIndex) {
        productsData.products[prodIndex].colorOptions[coIndex].gallery.splice(galleryIndex, 1);
        // Re-render just the gallery field
        const container = document.getElementById(`product-gallery-${prodIndex}-${coIndex}`);
        container.innerHTML = '';
        const galleryField = createImageArrayField('Gallery', productsData.products[prodIndex].colorOptions[coIndex].gallery || [], 
            (url) => addProductColorOptionGallery(prodIndex, coIndex, url),
            (index) => removeProductColorOptionGallery(prodIndex, coIndex, index)
        );
        container.appendChild(galleryField);
    }

    function addProduct() {
        if (!productsData.products) productsData.products = [];
        productsData.products.push({
            id: 'new-product-' + Date.now(),
            category: 'sofa',
            slug: 'new-product-' + Date.now(),
            name: 'New Product',
            price: '0.00',
            currency: 'Dhs.',
            color: 'White',
            colorCode: '#ffffff',
            colorOptions: [],
            description: '',
            features: '',
            deliveryDays: 0,
            monthlyPayment: '0.00',
            installmentPayment: '0.00'
        });
        renderProductsList();
    }

    function deleteProduct(index) {
        if (confirm('Are you sure you want to delete this product?')) {
            productsData.products.splice(index, 1);
            renderProductsList();
        }
    }

    async function saveProductsData() {
        try {
            // Clean data before saving
            const cleanedData = cleanProductsData(JSON.parse(JSON.stringify(productsData)));
            
            // Try to save via API first (for local development)
            const apiBase = getApiBaseUrl();
            try {
                const response = await fetch(`${apiBase}/api/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cleanedData, null, 2)
                });
                if (response.ok) {
                    showAlert('Products data saved successfully to server!', 'success');
                    productsData = cleanedData;
                    return;
                }
            } catch (apiError) {
                // API not available, try GitHub API
            }
            
            // Try GitHub API for Cloudflare Pages
            const saved = await saveToGitHub('src/_data/products.json', cleanedData);
            if (saved) {
                showAlert('Products data saved to GitHub! Cloudflare Pages will rebuild automatically.', 'success');
                productsData = cleanedData;
                return;
            }
            
            // Fallback: download the file
            downloadJSON('products');
            productsData = cleanedData;
            showAlert('Products data downloaded! Upload products.json to your repository to save changes.', 'success');
        } catch (error) {
            showAlert('Error saving products data: ' + error.message, 'error');
        }
    }

    // FURNITURE MANAGEMENT
    async function loadFurnitureData() {
        try {
            const apiBase = getApiBaseUrl();
            let response;
            
            // Try API first (for local development)
            try {
                response = await fetch(`${apiBase}/api/furniture`);
                if (response.ok) {
                    furnitureData = await response.json();
                    renderFurnitureList();
                    showAlert('Furniture data loaded successfully!', 'success');
                    return;
                }
            } catch (apiError) {
                // API not available, continue to static file fallback
            }
            
            // Try static file paths (for Cloudflare Pages)
            const staticPaths = [
                `${apiBase}/_data/furniture.json`,
                `${apiBase}/src/_data/furniture.json`,
                '/_data/furniture.json',
                '/src/_data/furniture.json'
            ];
            
            for (const path of staticPaths) {
                try {
                    response = await fetch(path);
                    if (response.ok) {
                        furnitureData = await response.json();
                        renderFurnitureList();
                        showAlert('Furniture data loaded successfully!', 'success');
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            throw new Error('Could not load furniture data from any source');
        } catch (error) {
            console.error('Error loading furniture data:', error);
            showAlert('Error loading furniture data. Make sure the JSON file exists in your repository.', 'error');
        }
    }

    function renderFurnitureList() {
        const container = document.getElementById('furniture-list');
        container.innerHTML = '';
        
        if (!furnitureData || furnitureData.length === 0) {
            container.innerHTML = '<p>No furniture categories found. Add your first category!</p>';
            return;
        }

        furnitureData.forEach((category, catIndex) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            
            card.innerHTML = `
                <div class="item-card-header">
                    <h3>${category.category || 'Unnamed Category'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="deleteFurnitureCategory(${catIndex})">Delete</button>
                </div>
                ${createFormField('Category Name', category.category, `updateFurnitureCategory(${catIndex}, 'category', this.value)`).outerHTML}
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Products (${category.products?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="furniture-products-${catIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addFurnitureProduct(${catIndex})">+ Add Product</button>
                    </div>
                </div>
            `;
            container.appendChild(card);
            renderFurnitureProducts(catIndex, category.products || []);
        });
    }

    function renderFurnitureProducts(catIndex, products) {
        const container = document.getElementById(`furniture-products-${catIndex}`);
        container.innerHTML = '';
        products.forEach((product, prodIndex) => {
            const prodCard = document.createElement('div');
            prodCard.className = 'array-item';
            prodCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">${product.title || 'Unnamed Product'}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeFurnitureProduct(${catIndex}, ${prodIndex})">Remove</button>
                </div>
                ${createFormField('ID', product.id, `updateFurnitureProduct(${catIndex}, ${prodIndex}, 'id', this.value)`, 'number').outerHTML}
                ${createFormField('Title', product.title, `updateFurnitureProduct(${catIndex}, ${prodIndex}, 'title', this.value)`).outerHTML}
                ${createFormField('Slug', product.slug, `updateFurnitureProduct(${catIndex}, ${prodIndex}, 'slug', this.value)`).outerHTML}
                <div class="form-row">
                    ${createFormField('Price', product.price, `updateFurnitureProduct(${catIndex}, ${prodIndex}, 'price', this.value)`, 'number').outerHTML}
                    ${createFormField('Featured', product.featured, `updateFurnitureProduct(${catIndex}, ${prodIndex}, 'featured', this.value)`, 'number').outerHTML}
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" ${product.onSale ? 'checked' : ''} 
                               onchange="updateFurnitureProduct(${catIndex}, ${prodIndex}, 'onSale', this.checked)">
                        On Sale
                    </label>
                </div>
                <div id="furniture-colors-${catIndex}-${prodIndex}"></div>
            `;
            container.appendChild(prodCard);
            
            // Render furniture product colors separately
            const colorsContainer = document.getElementById(`furniture-colors-${catIndex}-${prodIndex}`);
            const colorsField = createImageArrayField('Color Options', product.colorOptions || [], 
                (url) => addFurnitureProductColor(catIndex, prodIndex, url),
                (index) => removeFurnitureProductColor(catIndex, prodIndex, index)
            );
            colorsContainer.appendChild(colorsField);
        });
    }

    function updateFurnitureCategory(catIndex, field, value) {
        furnitureData[catIndex][field] = value;
    }

    function addFurnitureProduct(catIndex) {
        if (!furnitureData[catIndex].products) furnitureData[catIndex].products = [];
        furnitureData[catIndex].products.push({
            id: Date.now(),
            title: 'New Product',
            price: 0,
            featured: 0,
            slug: 'new-product-' + Date.now(),
            onSale: false,
            colorOptions: []
        });
        renderFurnitureProducts(catIndex, furnitureData[catIndex].products);
    }

    function removeFurnitureProduct(catIndex, prodIndex) {
        furnitureData[catIndex].products.splice(prodIndex, 1);
        renderFurnitureProducts(catIndex, furnitureData[catIndex].products);
    }

    function updateFurnitureProduct(catIndex, prodIndex, field, value) {
        if (field === 'id' || field === 'price' || field === 'featured') {
            furnitureData[catIndex].products[prodIndex][field] = parseFloat(value) || 0;
        } else if (field === 'onSale') {
            furnitureData[catIndex].products[prodIndex][field] = Boolean(value);
        } else {
            furnitureData[catIndex].products[prodIndex][field] = value;
        }
    }

    function addFurnitureProductColor(catIndex, prodIndex, url) {
        if (!url) return;
        if (!furnitureData[catIndex].products[prodIndex].colorOptions) {
            furnitureData[catIndex].products[prodIndex].colorOptions = [];
        }
        furnitureData[catIndex].products[prodIndex].colorOptions.push(url);
        // Re-render just the colors field
        const container = document.getElementById(`furniture-colors-${catIndex}-${prodIndex}`);
        container.innerHTML = '';
        const colorsField = createImageArrayField('Color Options', furnitureData[catIndex].products[prodIndex].colorOptions || [], 
            (url) => addFurnitureProductColor(catIndex, prodIndex, url),
            (index) => removeFurnitureProductColor(catIndex, prodIndex, index)
        );
        container.appendChild(colorsField);
    }

    function removeFurnitureProductColor(catIndex, prodIndex, colorIndex) {
        furnitureData[catIndex].products[prodIndex].colorOptions.splice(colorIndex, 1);
        // Re-render just the colors field
        const container = document.getElementById(`furniture-colors-${catIndex}-${prodIndex}`);
        container.innerHTML = '';
        const colorsField = createImageArrayField('Color Options', furnitureData[catIndex].products[prodIndex].colorOptions || [], 
            (url) => addFurnitureProductColor(catIndex, prodIndex, url),
            (index) => removeFurnitureProductColor(catIndex, prodIndex, index)
        );
        container.appendChild(colorsField);
    }

    function addFurnitureCategory() {
        if (!furnitureData) furnitureData = [];
        furnitureData.push({
            category: 'New Category',
            products: []
        });
        renderFurnitureList();
    }

    function deleteFurnitureCategory(index) {
        if (confirm('Are you sure you want to delete this category and all its products?')) {
            furnitureData.splice(index, 1);
            renderFurnitureList();
        }
    }

    async function saveFurnitureData() {
        try {
            // Clean data before saving
            const cleanedData = cleanFurnitureData(JSON.parse(JSON.stringify(furnitureData)));
            
            // Try to save via API first (for local development)
            const apiBase = getApiBaseUrl();
            try {
                const response = await fetch(`${apiBase}/api/furniture`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cleanedData, null, 2)
                });
                if (response.ok) {
                    showAlert('Furniture data saved successfully to server!', 'success');
                    furnitureData = cleanedData;
                    return;
                }
            } catch (apiError) {
                // API not available, try GitHub API
            }
            
            // Try GitHub API for Cloudflare Pages
            const saved = await saveToGitHub('src/_data/furniture.json', cleanedData);
            if (saved) {
                showAlert('Furniture data saved to GitHub! Cloudflare Pages will rebuild automatically.', 'success');
                furnitureData = cleanedData;
                return;
            }
            
            // Fallback: download the file
            downloadJSON('furniture');
            furnitureData = cleanedData;
            showAlert('Furniture data downloaded! Upload furniture.json to your repository to save changes.', 'success');
        } catch (error) {
            showAlert('Error saving furniture data: ' + error.message, 'error');
        }
    }

    // PROJECTS MANAGEMENT
    async function loadProjectsData() {
        try {
            const apiBase = getApiBaseUrl();
            let response;
            
            // Try API first (for local development)
            try {
                response = await fetch(`${apiBase}/api/projects`);
                if (response.ok) {
                    projectsData = await response.json();
                    renderProjectsList();
                    showAlert('Projects data loaded successfully!', 'success');
                    return;
                }
            } catch (apiError) {
                // API not available, continue to static file fallback
            }
            
            // Try static file paths (for Cloudflare Pages)
            const staticPaths = [
                `${apiBase}/_data/projects.json`,
                `${apiBase}/src/_data/projects.json`,
                '/_data/projects.json',
                '/src/_data/projects.json'
            ];
            
            for (const path of staticPaths) {
                try {
                    response = await fetch(path);
                    if (response.ok) {
                        projectsData = await response.json();
                        renderProjectsList();
                        showAlert('Projects data loaded successfully!', 'success');
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            throw new Error('Could not load projects data from any source');
        } catch (error) {
            console.error('Error loading projects data:', error);
            showAlert('Error loading projects data. Make sure the JSON file exists in your repository.', 'error');
        }
    }

    function renderProjectsList() {
        const container = document.getElementById('projects-list');
        container.innerHTML = '';
        
        if (!projectsData.projects || projectsData.projects.length === 0) {
            container.innerHTML = '<p>No projects found. Add your first project!</p>';
            return;
        }

        projectsData.projects.forEach((project, projIndex) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            
            card.innerHTML = `
                <div class="item-card-header">
                    <h3>${project.title || 'Unnamed Project'}</h3>
                    <button class="btn btn-danger btn-sm" onclick="deleteProject(${projIndex})">Delete</button>
                </div>
                ${createFormField('Slug', project.slug, `updateProjectField(${projIndex}, 'slug', this.value)`).outerHTML}
                ${createFormField('Title', project.title, `updateProjectField(${projIndex}, 'title', this.value)`).outerHTML}
                ${createFormField('Category', project.category, `updateProjectField(${projIndex}, 'category', this.value)`).outerHTML}
                ${createFormField('Icon (Font Awesome)', project.icon, `updateProjectField(${projIndex}, 'icon', this.value)`).outerHTML}
                ${createImageUploadField('Hero Image', project.hero_image || '', `updateProjectField(${projIndex}, 'hero_image', this.value)`).outerHTML}
                ${createFormField('Description Lead', project.description?.lead || '', `updateProjectDescription(${projIndex}, 'lead', this.value)`, 'textarea').outerHTML}
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Description Paragraphs (${project.description?.paragraphs?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="project-paragraphs-${projIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addProjectParagraph(${projIndex})">+ Add Paragraph</button>
                    </div>
                </div>
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Gallery (${project.gallery?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="project-gallery-${projIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addProjectGalleryItem(${projIndex})">+ Add Gallery Item</button>
                    </div>
                </div>
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Details (${project.details?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="project-details-${projIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addProjectDetail(${projIndex})">+ Add Detail</button>
                    </div>
                </div>
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Features (${project.features?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="project-features-${projIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addProjectFeature(${projIndex})">+ Add Feature</button>
                    </div>
                </div>
                <div class="nested-section">
                    <h4 style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0;">Transformation Section (Before/After)</h4>
                    ${createImageUploadField('Before Image', project.before_after?.before_image || '', `updateProjectBeforeAfter(${projIndex}, 'before_image', this.value)`).outerHTML}
                    ${createImageUploadField('After Image', project.before_after?.after_image || '', `updateProjectBeforeAfter(${projIndex}, 'after_image', this.value)`).outerHTML}
                    ${createFormField('Description', project.before_after?.description || '', `updateProjectBeforeAfter(${projIndex}, 'description', this.value)`, 'textarea').outerHTML}
                </div>
                <div class="nested-section">
                    <h4 class="collapsible" onclick="toggleCollapsible(this)">Timeline (${project.timeline?.length || 0})</h4>
                    <div class="collapsible-content">
                        <div id="project-timeline-${projIndex}"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addProjectTimelineItem(${projIndex})">+ Add Timeline Item</button>
                    </div>
                </div>
            `;
            container.appendChild(card);
            
            renderProjectParagraphs(projIndex, project.description?.paragraphs || []);
            renderProjectGallery(projIndex, project.gallery || []);
            renderProjectDetails(projIndex, project.details || []);
            renderProjectFeatures(projIndex, project.features || []);
            renderProjectTimeline(projIndex, project.timeline || []);
        });
    }

    function renderProjectParagraphs(projIndex, paragraphs) {
        const container = document.getElementById(`project-paragraphs-${projIndex}`);
        container.innerHTML = '';
        paragraphs.forEach((para, paraIndex) => {
            const paraCard = document.createElement('div');
            paraCard.className = 'array-item';
            paraCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">Paragraph ${paraIndex + 1}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeProjectParagraph(${projIndex}, ${paraIndex})">Remove</button>
                </div>
                ${createFormField('Text', para, `updateProjectParagraph(${projIndex}, ${paraIndex}, this.value)`, 'textarea').outerHTML}
            `;
            container.appendChild(paraCard);
        });
    }

    function renderProjectGallery(projIndex, gallery) {
        const container = document.getElementById(`project-gallery-${projIndex}`);
        container.innerHTML = '';
        gallery.forEach((item, itemIndex) => {
            const mainImageField = createImageUploadField('Main Image (Gallery)', item.image || '', `updateProjectGalleryItem(${projIndex}, ${itemIndex}, 'image', this.value)`);
            const thumbnailField = createImageUploadField('Thumbnail Image', item.thumbnail || '', `updateProjectGalleryItem(${projIndex}, ${itemIndex}, 'thumbnail', this.value)`);
            const altField = createFormField('Alt Text', item.alt || '', `updateProjectGalleryItem(${projIndex}, ${itemIndex}, 'alt', this.value)`);
            
            const itemCard = document.createElement('div');
            itemCard.className = 'array-item';
            itemCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">Gallery Item ${itemIndex + 1}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeProjectGalleryItem(${projIndex}, ${itemIndex})">Remove</button>
                </div>
                ${mainImageField.outerHTML}
                ${thumbnailField.outerHTML}
                ${altField.outerHTML}
            `;
            container.appendChild(itemCard);
        });
    }

    function renderProjectDetails(projIndex, details) {
        const container = document.getElementById(`project-details-${projIndex}`);
        container.innerHTML = '';
        details.forEach((detail, detailIndex) => {
            const detailCard = document.createElement('div');
            detailCard.className = 'array-item';
            detailCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">${detail.label || 'Detail'}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeProjectDetail(${projIndex}, ${detailIndex})">Remove</button>
                </div>
                ${createFormField('Label', detail.label || '', `updateProjectDetail(${projIndex}, ${detailIndex}, 'label', this.value)`).outerHTML}
                ${createFormField('Value', detail.value || '', `updateProjectDetail(${projIndex}, ${detailIndex}, 'value', this.value)`).outerHTML}
            `;
            container.appendChild(detailCard);
        });
    }

    function renderProjectFeatures(projIndex, features) {
        const container = document.getElementById(`project-features-${projIndex}`);
        container.innerHTML = '';
        features.forEach((feature, featIndex) => {
            const featCard = document.createElement('div');
            featCard.className = 'array-item';
            featCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">Feature ${featIndex + 1}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeProjectFeature(${projIndex}, ${featIndex})">Remove</button>
                </div>
                ${createFormField('Feature Text', feature, `updateProjectFeature(${projIndex}, ${featIndex}, this.value)`).outerHTML}
            `;
            container.appendChild(featCard);
        });
    }

    function renderProjectTimeline(projIndex, timeline) {
        const container = document.getElementById(`project-timeline-${projIndex}`);
        container.innerHTML = '';
        timeline.forEach((item, itemIndex) => {
            const itemCard = document.createElement('div');
            itemCard.className = 'array-item';
            itemCard.innerHTML = `
                <div class="array-item-header">
                    <span class="array-item-title">${item.period || 'Timeline Item'}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeProjectTimelineItem(${projIndex}, ${itemIndex})">Remove</button>
                </div>
                ${createFormField('Period', item.period || '', `updateProjectTimelineItem(${projIndex}, ${itemIndex}, 'period', this.value)`).outerHTML}
                ${createFormField('Title', item.title || '', `updateProjectTimelineItem(${projIndex}, ${itemIndex}, 'title', this.value)`).outerHTML}
                ${createFormField('Description', item.description || '', `updateProjectTimelineItem(${projIndex}, ${itemIndex}, 'description', this.value)`, 'textarea').outerHTML}
            `;
            container.appendChild(itemCard);
        });
    }

    function updateProjectField(projIndex, field, value) {
        projectsData.projects[projIndex][field] = value;
    }

    function updateProjectDescription(projIndex, field, value) {
        if (!projectsData.projects[projIndex].description) {
            projectsData.projects[projIndex].description = {};
        }
        projectsData.projects[projIndex].description[field] = value;
    }

    function addProjectParagraph(projIndex) {
        if (!projectsData.projects[projIndex].description) {
            projectsData.projects[projIndex].description = {};
        }
        if (!projectsData.projects[projIndex].description.paragraphs) {
            projectsData.projects[projIndex].description.paragraphs = [];
        }
        projectsData.projects[projIndex].description.paragraphs.push('New paragraph');
        renderProjectParagraphs(projIndex, projectsData.projects[projIndex].description.paragraphs);
    }

    function removeProjectParagraph(projIndex, paraIndex) {
        projectsData.projects[projIndex].description.paragraphs.splice(paraIndex, 1);
        renderProjectParagraphs(projIndex, projectsData.projects[projIndex].description.paragraphs);
    }

    function updateProjectParagraph(projIndex, paraIndex, value) {
        projectsData.projects[projIndex].description.paragraphs[paraIndex] = value;
    }

    function addProjectGalleryItem(projIndex) {
        if (!projectsData.projects[projIndex].gallery) {
            projectsData.projects[projIndex].gallery = [];
        }
        projectsData.projects[projIndex].gallery.push({
            image: '',
            thumbnail: '',
            alt: ''
        });
        renderProjectGallery(projIndex, projectsData.projects[projIndex].gallery);
    }

    function removeProjectGalleryItem(projIndex, itemIndex) {
        projectsData.projects[projIndex].gallery.splice(itemIndex, 1);
        renderProjectGallery(projIndex, projectsData.projects[projIndex].gallery);
    }

    function updateProjectGalleryItem(projIndex, itemIndex, field, value) {
        projectsData.projects[projIndex].gallery[itemIndex][field] = value;
    }

    function addProjectDetail(projIndex) {
        if (!projectsData.projects[projIndex].details) {
            projectsData.projects[projIndex].details = [];
        }
        projectsData.projects[projIndex].details.push({
            label: '',
            value: ''
        });
        renderProjectDetails(projIndex, projectsData.projects[projIndex].details);
    }

    function removeProjectDetail(projIndex, detailIndex) {
        projectsData.projects[projIndex].details.splice(detailIndex, 1);
        renderProjectDetails(projIndex, projectsData.projects[projIndex].details);
    }

    function updateProjectDetail(projIndex, detailIndex, field, value) {
        projectsData.projects[projIndex].details[detailIndex][field] = value;
    }

    function addProjectFeature(projIndex) {
        if (!projectsData.projects[projIndex].features) {
            projectsData.projects[projIndex].features = [];
        }
        projectsData.projects[projIndex].features.push('New feature');
        renderProjectFeatures(projIndex, projectsData.projects[projIndex].features);
    }

    function removeProjectFeature(projIndex, featIndex) {
        projectsData.projects[projIndex].features.splice(featIndex, 1);
        renderProjectFeatures(projIndex, projectsData.projects[projIndex].features);
    }

    function updateProjectFeature(projIndex, featIndex, value) {
        projectsData.projects[projIndex].features[featIndex] = value;
    }

    function addProjectTimelineItem(projIndex) {
        if (!projectsData.projects[projIndex].timeline) {
            projectsData.projects[projIndex].timeline = [];
        }
        projectsData.projects[projIndex].timeline.push({
            period: '',
            title: '',
            description: ''
        });
        renderProjectTimeline(projIndex, projectsData.projects[projIndex].timeline);
    }

    function removeProjectTimelineItem(projIndex, itemIndex) {
        projectsData.projects[projIndex].timeline.splice(itemIndex, 1);
        renderProjectTimeline(projIndex, projectsData.projects[projIndex].timeline);
    }

    function updateProjectTimelineItem(projIndex, itemIndex, field, value) {
        projectsData.projects[projIndex].timeline[itemIndex][field] = value;
    }


    function updateProjectBeforeAfter(projIndex, field, value) {
        if (!projectsData.projects[projIndex].before_after) {
            projectsData.projects[projIndex].before_after = {};
        }
        projectsData.projects[projIndex].before_after[field] = value;
    }

    function addProject() {
        if (!projectsData.projects) projectsData.projects = [];
        projectsData.projects.push({
            slug: 'new-project-' + Date.now(),
            title: 'New Project',
            category: '',
            hero_image: '',
            icon: 'fas fa-home',
            gallery: [],
            details: [],
            description: {
                lead: '',
                paragraphs: []
            },
            features: [],
            before_after: {
                description: '',
                before_image: '',
                after_image: ''
            },
            timeline: []
        });
        renderProjectsList();
    }

    function deleteProject(index) {
        if (confirm('Are you sure you want to delete this project?')) {
            projectsData.projects.splice(index, 1);
            renderProjectsList();
        }
    }

    async function saveProjectsData() {
        try {
            // Clean data before saving - remove fields not in admin panel
            const cleanedData = cleanProjectsData(JSON.parse(JSON.stringify(projectsData)));
            
            // Try to save via API first (for local development)
            const apiBase = getApiBaseUrl();
            try {
                const response = await fetch(`${apiBase}/api/projects`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cleanedData, null, 2)
                });
                if (response.ok) {
                    showAlert('Projects data saved successfully to server!', 'success');
                    // Update local data with cleaned version
                    projectsData = cleanedData;
                    return;
                }
            } catch (apiError) {
                // API not available, try GitHub API
            }
            
            // Try GitHub API for Cloudflare Pages
            const saved = await saveToGitHub('src/_data/projects.json', cleanedData);
            if (saved) {
                showAlert('Projects data saved to GitHub! Cloudflare Pages will rebuild automatically.', 'success');
                // Update local data with cleaned version
                projectsData = cleanedData;
                return;
            }
            
            // Fallback: download the file
            const dataStr = JSON.stringify(cleanedData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'projects.json';
            link.click();
            URL.revokeObjectURL(url);
            // Update local data with cleaned version
            projectsData = cleanedData;
            showAlert('Projects data downloaded! Upload projects.json to your repository to save changes.', 'success');
        } catch (error) {
            showAlert('Error saving projects data: ' + error.message, 'error');
        }
    }

    // Utility functions
    function showAlert(message, type) {
        const container = document.getElementById('alertContainer');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.textContent = message;
        container.innerHTML = '';
        container.appendChild(alert);
        setTimeout(() => alert.remove(), 5000);
    }

    // Clean projects data - remove fields not in admin panel
    function cleanProjectsData(data) {
        if (!data || !data.projects) return data;
        
        const allowedFields = [
            'slug', 'title', 'category', 'hero_image', 'icon',
            'gallery', 'details', 'description', 'features',
            'before_after', 'timeline'
        ];
        
        data.projects = data.projects.map(project => {
            const cleaned = {};
            allowedFields.forEach(field => {
                if (project[field] !== undefined) {
                    cleaned[field] = project[field];
                }
            });
            return cleaned;
        });
        
        return data;
    }

    // Clean packages data - remove fields not in admin panel
    function cleanPackagesData(data) {
        if (!data || !data.packages) return data;
        // All fields in packages are editable, so no cleaning needed
        return data;
    }

    // Clean products data - remove fields not in admin panel
    function cleanProductsData(data) {
        if (!data || !data.products) return data;
        // All fields in products are editable, so no cleaning needed
        return data;
    }

    // Clean furniture data - remove fields not in admin panel
    function cleanFurnitureData(data) {
        if (!data || !Array.isArray(data)) return data;
        // All fields in furniture are editable, so no cleaning needed
        return data;
    }

    // Clean design services data - remove fields not in admin panel
    function cleanDesignServicesData(data) {
        if (!data) return data;
        // All fields in design services are editable, so no cleaning needed
        return data;
    }

    function cleanContactData(data) {
        if (!data) return data;
        // All fields in contact are editable, so no cleaning needed
        return data;
    }

    // Clean homepage data - remove fields not in admin panel
    function cleanHomepageData(data) {
        if (!data) return data;
        // All fields in homepage are editable, so no cleaning needed
        return data;
    }

    // Load data on page load
    window.addEventListener('DOMContentLoaded', () => {
        showAlert('Admin panel ready. Click "Load Current Data" to start editing.', 'success');
    });
</script>

</body>
</html>
